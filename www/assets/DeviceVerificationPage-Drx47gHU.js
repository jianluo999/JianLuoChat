import{j as M,f as P,g as o,h as c,y as W,c as $,a as e,m as i,E as s,D as d,K as n,t as u,e as a,l as z,b as S,o as b,_ as j}from"./index-Cl5nGqgc.js";import{C as F,D as Q}from"./CryptoConflictWarning-C8ICMdaN.js";import{E as T}from"./EncryptionIndicator-DOmuLn2f.js";import"./cryptoConflictManager-Dn8jFaYI.js";const K={class:"device-verification-page"},U={class:"card-header"},q={class:"current-device-info"},A={class:"device-details"},G={class:"detail-item"},H={class:"detail-value"},J={class:"detail-item"},L={class:"detail-value"},O={class:"detail-item"},X={class:"detail-item"},Y={class:"device-actions"},Z={class:"card-header"},ee={class:"verification-guide"},le={class:"guide-section"},te={class:"security-tips"},se=M({__name:"DeviceVerificationPage",setup(ie){const f=P(),v=o(),V=o(),p=o(!1),_=o(!1),m=o(!1),r=c(()=>!!f.matrixClient?.getCrypto()),h=c(()=>f.matrixClient?.getDeviceId()||"未知"),x=c(()=>"简洛聊天 Web 客户端"),y=c(()=>!0),k=async()=>{p.value=!0;try{const t=f.matrixClient;if(!t)throw new Error("Matrix客户端未初始化");if(typeof t.initRustCrypto=="function")await t.initRustCrypto({useIndexedDB:!0,cryptoDatabasePrefix:"jianluochat-crypto"}),n.success("端到端加密已启用");else throw new Error("客户端不支持加密功能")}catch(t){console.error("启用加密失败:",t),n.error(`启用加密失败: ${t.message}`)}finally{p.value=!1}},C=async()=>{_.value=!0;try{await new Promise(t=>setTimeout(t,1e3)),n.success("设备信息已刷新")}catch(t){console.error("刷新设备信息失败:",t),n.error("刷新失败")}finally{_.value=!1}},E=async()=>{m.value=!0;try{v.value&&await v.value.loadUserDevices(),n.success("设备列表已刷新")}catch(t){console.error("刷新设备失败:",t),n.error(`刷新失败: ${t.message}`)}finally{m.value=!1}},R=t=>{console.log("设备验证成功:",t),n.success(`设备 ${t} 验证成功`)},I=t=>{console.error("设备验证失败:",t),n.error(`验证失败: ${t}`)},B=t=>{console.warn("检测到加密冲突:",t),n.warning("检测到加密冲突，请查看警告信息")};return W(()=>{C()}),(t,l)=>{const w=d("el-tag"),g=d("el-button"),D=d("el-card"),N=d("el-alert");return b(),$("div",K,[l[14]||(l[14]=e("div",{class:"page-header"},[e("h1",null,"🛡️ 设备验证"),e("p",{class:"header-description"}," 验证您的设备以确保端到端加密通信的安全性 ")],-1)),i(F,{ref_key:"conflictWarningRef",ref:V,onConflictDetected:B},null,512),i(D,{class:"current-device-card"},{header:s(()=>[e("div",U,[l[0]||(l[0]=e("span",null,"当前设备",-1)),i(T,{type:"device",verified:y.value,encrypted:r.value},null,8,["verified","encrypted"])])]),default:s(()=>[e("div",q,[e("div",A,[e("div",G,[l[1]||(l[1]=e("span",{class:"detail-label"},"设备ID:",-1)),e("span",H,u(h.value),1)]),e("div",J,[l[2]||(l[2]=e("span",{class:"detail-label"},"设备名称:",-1)),e("span",L,u(x.value),1)]),e("div",O,[l[3]||(l[3]=e("span",{class:"detail-label"},"加密状态:",-1)),i(w,{type:r.value?"success":"warning",size:"small"},{default:s(()=>[a(u(r.value?"已启用":"未启用"),1)]),_:1},8,["type"])]),e("div",X,[l[4]||(l[4]=e("span",{class:"detail-label"},"验证状态:",-1)),i(w,{type:y.value?"success":"info",size:"small"},{default:s(()=>[a(u(y.value?"已验证":"当前设备"),1)]),_:1},8,["type"])])]),e("div",Y,[r.value?S("",!0):(b(),z(g,{key:0,onClick:k,type:"primary",loading:p.value},{default:s(()=>l[5]||(l[5]=[a(" 启用加密 ")])),_:1,__:[5]},8,["loading"])),i(g,{onClick:C,loading:_.value},{default:s(()=>l[6]||(l[6]=[a(" 刷新信息 ")])),_:1,__:[6]},8,["loading"])])])]),_:1}),i(D,{class:"verification-card"},{header:s(()=>[e("div",Z,[l[8]||(l[8]=e("span",null,"设备管理",-1)),i(g,{type:"primary",size:"small",onClick:E,loading:m.value},{default:s(()=>l[7]||(l[7]=[a(" 刷新设备列表 ")])),_:1,__:[7]},8,["loading"])])]),default:s(()=>[i(Q,{ref_key:"deviceVerificationRef",ref:v,"show-device-list":!0,onDeviceVerified:R,onVerificationFailed:I},null,512)]),_:1}),i(D,{class:"guide-card"},{header:s(()=>l[9]||(l[9]=[e("span",null,"验证指南",-1)])),default:s(()=>[e("div",ee,[l[12]||(l[12]=e("div",{class:"guide-section"},[e("h3",null,"为什么需要验证设备？"),e("ul",null,[e("li",null,"确保只有您授权的设备能够解密您的消息"),e("li",null,"防止中间人攻击和未授权访问"),e("li",null,"提高端到端加密的安全性")])],-1)),l[13]||(l[13]=e("div",{class:"guide-section"},[e("h3",null,"如何验证设备？"),e("ol",null,[e("li",null,"在设备列表中找到要验证的设备"),e("li",null,'点击"验证设备"按钮'),e("li",null,[a("选择验证方式： "),e("ul",null,[e("li",null,[e("strong",null,"表情符号验证："),a("比较两台设备上显示的表情符号")]),e("li",null,[e("strong",null,"QR码验证："),a("用另一台设备扫描QR码")])])]),e("li",null,"确认验证信息匹配后完成验证")])],-1)),e("div",le,[l[11]||(l[11]=e("h3",null,"安全提示",-1)),e("div",te,[i(N,{title:"重要提醒",type:"warning",closable:!1,"show-icon":""},{default:s(()=>l[10]||(l[10]=[e("ul",null,[e("li",null,"只验证您确认拥有的设备"),e("li",null,"如果发现未知设备，请立即删除"),e("li",null,"定期检查设备列表，移除不再使用的设备"),e("li",null,"如果怀疑账户被盗用，请立即重置加密设置")],-1)])),_:1,__:[10]})])])])]),_:1})])}}}),ce=j(se,[["__scopeId","data-v-12a2bf7d"]]);export{ce as default};
