import{j as A,f as Q,g as v,h as O,c as l,q as X,n as N,b as _,a as e,t as g,w as P,v as G,F as z,r as U,U as ie,p as q,o as n,_ as J,k as ee,d as ce,X as Y,y as se,A as de,m as Z,l as te,W as ue,i as me}from"./index-Cl5nGqgc.js";import{M as pe}from"./MatrixMessageInput-DhpyKYJ-.js";const ve={class:"reply-content"},ge={class:"reply-sender"},he={class:"reply-text"},fe={key:1,class:"message-header"},ye={class:"sender-name"},_e={class:"message-time"},$e={class:"message-content"},ke={key:0,class:"edit-mode"},be={class:"edit-actions"},Me=["disabled"],Te={key:1,class:"message-body"},we={key:0,class:"deleted-message"},Ce={key:0,class:"deletion-reason"},Ie={key:1},Se={key:0,class:"text-message"},xe=["innerHTML"],Re={key:0,class:"edited-indicator"},De={key:1,class:"file-message"},Ee={class:"file-info"},He={class:"file-name"},Ne={class:"file-size"},Be={key:2,class:"image-message"},Fe=["src","alt"],Le={key:2,class:"own-message-time"},je={key:2,class:"message-reactions"},ze=["onClick"],Ue={class:"reaction-emoji"},Ve={class:"reaction-count"},Ke={key:4,class:"emoji-selector"},Oe={class:"emoji-grid"},Pe=["onClick"],qe=A({__name:"MatrixMessageItem",props:{message:{},roomId:{}},emits:["reply-to","scroll-to"],setup(V,{emit:w}){const r=V,f=w,M=Q(),h=v(!1),y=v(""),c=v(!1),C=v(!1),T=v({top:"0px",left:"0px"}),H=v(),R=v(0),D=["👍","👎","❤️","😂","😮","😢","😡","🎉","🔥","💯"],E=O(()=>r.message.isOwn&&!r.message.isRedacted),L=O(()=>r.message.isOwn&&!r.message.isRedacted),B=()=>{R.value=Date.now()},F=()=>{Date.now()-R.value>500&&x()},x=s=>{s&&(T.value={top:s.clientY+"px",left:s.clientX+"px"}),c.value=!0,setTimeout(()=>{document.addEventListener("click",o,{once:!0})},0)},o=()=>{c.value=!1,C.value=!1},t=()=>{f("reply-to",r.message),o()},b=()=>{h.value=!0,y.value=r.message.content,o(),q(()=>{H.value?.focus()})},p=()=>{h.value=!1,y.value=""},a=async()=>{if(y.value.trim())try{await M.editMessage(r.roomId,r.message.eventId,y.value.trim()),h.value=!1,y.value=""}catch(s){console.error("编辑消息失败:",s)}},u=s=>{s.key==="Enter"&&!s.shiftKey?(s.preventDefault(),a()):s.key==="Escape"&&p()},$=async()=>{if(confirm("确定要删除这条消息吗？"))try{await M.deleteMessage(r.roomId,r.message.eventId),o()}catch(s){console.error("删除消息失败:",s)}},k=()=>{navigator.clipboard.writeText(r.message.content),o()},i=()=>{C.value=!C.value,o()},m=async s=>{try{await M.addReaction(r.roomId,r.message.eventId,s),C.value=!1}catch(d){console.error("添加反应失败:",d)}},I=async s=>{const d=r.message.reactions?.[s];if(d)try{d.hasReacted?await M.removeReaction(r.roomId,r.message.eventId,s):await M.addReaction(r.roomId,r.message.eventId,s)}catch(S){console.error("切换反应失败:",S)}},W=s=>{f("scroll-to",s)},K=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),oe=s=>s.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"),ae=s=>{if(s===0)return"0 B";const d=1024,S=["B","KB","MB","GB"],j=Math.floor(Math.log(s)/Math.log(d));return parseFloat((s/Math.pow(d,j)).toFixed(2))+" "+S[j]},ne=s=>"",le=s=>{},re=s=>{};return(s,d)=>(n(),l("div",{class:N(["message-item",{"own-message":s.message.isOwn,editing:h.value,deleted:s.message.isRedacted}]),onContextmenu:X(x,["prevent"]),onTouchstart:B,onTouchend:F},[s.message.replyTo?(n(),l("div",{key:0,class:"reply-reference",onClick:d[0]||(d[0]=S=>W(s.message.replyTo.eventId))},[d[4]||(d[4]=e("div",{class:"reply-line"},null,-1)),e("div",ve,[e("span",ge,g(s.message.replyTo.senderName),1),e("span",he,g(s.message.replyTo.content),1)])])):_("",!0),s.message.isOwn?_("",!0):(n(),l("div",fe,[e("span",ye,g(s.message.senderName),1),e("span",_e,g(K(s.message.timestamp)),1)])),e("div",$e,[h.value?(n(),l("div",ke,[P(e("textarea",{ref_key:"editInput",ref:H,"onUpdate:modelValue":d[1]||(d[1]=S=>y.value=S),onKeydown:u,class:"edit-textarea",placeholder:"编辑消息..."},null,544),[[G,y.value]]),e("div",be,[e("button",{onClick:p,class:"cancel-btn"},"取消"),e("button",{onClick:a,class:"save-btn",disabled:!y.value.trim()},"保存",8,Me)])])):(n(),l("div",Te,[s.message.isRedacted?(n(),l("div",we,[d[5]||(d[5]=e("span",{class:"deleted-icon"},"🗑️",-1)),d[6]||(d[6]=e("span",{class:"deleted-text"},"此消息已被删除",-1)),s.message.redactionReason?(n(),l("span",Ce," ("+g(s.message.redactionReason)+") ",1)):_("",!0)])):(n(),l("div",Ie,[s.message.msgtype==="m.text"?(n(),l("div",Se,[e("div",{innerHTML:oe(s.message.content)},null,8,xe),s.message.isEdited?(n(),l("div",Re,d[7]||(d[7]=[e("span",{class:"edited-text"},"(已编辑)",-1)]))):_("",!0)])):s.message.msgtype==="m.file"?(n(),l("div",De,[e("div",Ee,[d[8]||(d[8]=e("span",{class:"file-icon"},"📄",-1)),e("span",He,g(s.message.filename),1),e("span",Ne,"("+g(ae(s.message.filesize))+")",1)]),e("button",{onClick:d[2]||(d[2]=S=>le(s.message)),class:"download-btn"},"下载")])):s.message.msgtype==="m.image"?(n(),l("div",Be,[e("img",{src:ne(s.message),alt:s.message.filename,onClick:d[3]||(d[3]=S=>re(s.message)),class:"message-image"},null,8,Fe)])):_("",!0)]))])),s.message.isOwn?(n(),l("div",Le,g(K(s.message.timestamp)),1)):_("",!0)]),s.message.reactions&&Object.keys(s.message.reactions).length>0?(n(),l("div",je,[(n(!0),l(z,null,U(s.message.reactions,(S,j)=>(n(),l("button",{key:j,onClick:it=>I(j),class:N(["reaction-btn",{"has-reacted":S.hasReacted}])},[e("span",Ue,g(j),1),e("span",Ve,g(S.count),1)],10,ze))),128)),e("button",{onClick:i,class:"add-reaction-btn"},"+")])):_("",!0),c.value?(n(),l("div",{key:3,class:"context-menu",style:ie(T.value)},[e("button",{onClick:t,class:"menu-item"},d[9]||(d[9]=[e("span",{class:"menu-icon"},"↩️",-1),e("span",null,"回复",-1)])),E.value?(n(),l("button",{key:0,onClick:b,class:"menu-item"},d[10]||(d[10]=[e("span",{class:"menu-icon"},"✏️",-1),e("span",null,"编辑",-1)]))):_("",!0),e("button",{onClick:i,class:"menu-item"},d[11]||(d[11]=[e("span",{class:"menu-icon"},"😊",-1),e("span",null,"添加反应",-1)])),e("button",{onClick:k,class:"menu-item"},d[12]||(d[12]=[e("span",{class:"menu-icon"},"📋",-1),e("span",null,"复制",-1)])),L.value?(n(),l("button",{key:1,onClick:$,class:"menu-item delete-item"},d[13]||(d[13]=[e("span",{class:"menu-icon"},"🗑️",-1),e("span",null,"删除",-1)]))):_("",!0)],4)):_("",!0),C.value?(n(),l("div",Ke,[e("div",Oe,[(n(),l(z,null,U(D,S=>e("button",{key:S,onClick:j=>m(S),class:"emoji-option"},g(S),9,Pe)),64))])])):_("",!0)],34))}}),Ae=J(qe,[["__scopeId","data-v-5c952bbd"]]),Qe={class:"search-input-area"},Je={class:"search-input-wrapper"},We=["disabled"],Xe={key:0},Ge={key:1,class:"searching-spinner"},Ye={class:"search-options"},Ze={class:"search-option"},es={class:"search-option"},ss={class:"search-results"},ts={key:0,class:"search-status"},os={key:1,class:"no-results"},as={key:2,class:"results-list"},ns={class:"results-header"},ls={class:"results-count"},rs=["onClick"],is={class:"result-content"},cs={class:"result-header"},ds={class:"result-sender"},us={class:"result-time"},ms={key:0,class:"result-room"},ps={class:"result-message"},vs=["innerHTML"],gs={key:0,class:"result-context"},hs={key:0,class:"context-before"},fs={class:"context-sender"},ys={class:"context-content"},_s={key:1,class:"context-after"},$s={class:"context-sender"},ks={class:"context-content"},bs={class:"result-actions"},Ms=["onClick"],Ts={key:3,class:"search-placeholder"},ws=A({__name:"MessageSearchDialog",props:{visible:{type:Boolean},roomId:{}},emits:["close","jump-to-message"],setup(V,{emit:w}){const r=V,f=w,M=Q(),h=v(""),y=v("current"),c=v(!1),C=v(!1),T=v([]),H=v(-1),R=v();let D=null;ee(()=>r.visible,p=>{p?q(()=>{R.value?.focus()}):(h.value="",T.value=[],C.value=!1,H.value=-1)});const E=()=>{f("close")},L=()=>{D&&clearTimeout(D),D=setTimeout(()=>{h.value.trim()&&B()},500)},B=async()=>{const p=h.value.trim();if(p){c.value=!0,C.value=!0,T.value=[];try{if(y.value==="current"&&r.roomId){const a=await M.searchMessages(r.roomId,p);T.value=a}else{const a=[],u=M.rooms;for(const $ of u)try{const i=(await M.searchMessages($.id,p)).map(m=>({...m,room_id:$.id,room_name:$.name}));a.push(...i)}catch(k){console.warn(`搜索房间 ${$.id} 失败:`,k)}a.sort(($,k)=>k.result.origin_server_ts-$.result.origin_server_ts),T.value=a}}catch(a){console.error("搜索失败:",a)}finally{c.value=!1}}},F=p=>{const a=p.result.event_id,u=p.room_id||r.roomId;f("jump-to-message",a,u),E()},x=p=>p.split(":")[0].substring(1),o=p=>{const a=new Date(p),$=Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60*24));return $===0?a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):$===1?"昨天 "+a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):$<7?$+"天前":a.toLocaleDateString("zh-CN")},t=p=>{if(!h.value.trim())return p;const a=new RegExp(`(${b(h.value)})`,"gi");return p.replace(a,"<mark>$1</mark>")},b=p=>p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return(p,a)=>p.visible?(n(),l("div",{key:0,class:"search-dialog-overlay",onClick:E},[e("div",{class:"search-dialog",onClick:a[3]||(a[3]=X(()=>{},["stop"]))},[e("div",{class:"search-header"},[a[4]||(a[4]=e("h3",null,"消息搜索",-1)),e("button",{onClick:E,class:"close-btn"},"×")]),e("div",Qe,[e("div",Je,[P(e("input",{ref_key:"searchInput",ref:R,"onUpdate:modelValue":a[0]||(a[0]=u=>h.value=u),onInput:L,onKeydown:ce(B,["enter"]),placeholder:"搜索消息内容...",class:"search-input"},null,544),[[G,h.value]]),e("button",{onClick:B,disabled:!h.value.trim()||c.value,class:"search-btn"},[c.value?(n(),l("span",Ge)):(n(),l("span",Xe,"🔍"))],8,We)]),e("div",Ye,[e("label",Ze,[P(e("input",{type:"radio","onUpdate:modelValue":a[1]||(a[1]=u=>y.value=u),value:"current"},null,512),[[Y,y.value]]),a[5]||(a[5]=e("span",null,"当前房间",-1))]),e("label",es,[P(e("input",{type:"radio","onUpdate:modelValue":a[2]||(a[2]=u=>y.value=u),value:"all"},null,512),[[Y,y.value]]),a[6]||(a[6]=e("span",null,"所有房间",-1))])])]),e("div",ss,[c.value?(n(),l("div",ts,a[7]||(a[7]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"搜索中...",-1)]))):C.value&&T.value.length===0?(n(),l("div",os,a[8]||(a[8]=[e("div",{class:"no-results-icon"},"🔍",-1),e("div",{class:"no-results-text"},[e("p",null,"未找到相关消息"),e("p",{class:"no-results-hint"},"尝试使用不同的关键词")],-1)]))):T.value.length>0?(n(),l("div",as,[e("div",ns,[e("span",ls,"找到 "+g(T.value.length)+" 条消息",1)]),(n(!0),l(z,null,U(T.value,(u,$)=>(n(),l("div",{key:u.result.event_id,onClick:k=>F(u),class:N(["result-item",{selected:H.value===$}])},[e("div",is,[e("div",cs,[e("span",ds,g(x(u.result.sender)),1),e("span",us,g(o(u.result.origin_server_ts)),1),u.room_name?(n(),l("span",ms,g(u.room_name),1)):_("",!0)]),e("div",ps,[e("div",{innerHTML:t(u.result.content.body)},null,8,vs)]),u.context?(n(),l("div",gs,[u.context.events_before?.length?(n(),l("div",hs,[(n(!0),l(z,null,U(u.context.events_before,k=>(n(),l("div",{key:k.event_id,class:"context-message"},[e("span",fs,g(x(k.sender))+":",1),e("span",ys,g(k.content.body),1)]))),128))])):_("",!0),u.context.events_after?.length?(n(),l("div",_s,[(n(!0),l(z,null,U(u.context.events_after,k=>(n(),l("div",{key:k.event_id,class:"context-message"},[e("span",$s,g(x(k.sender))+":",1),e("span",ks,g(k.content.body),1)]))),128))])):_("",!0)])):_("",!0)]),e("div",bs,[e("button",{onClick:X(k=>F(u),["stop"]),class:"jump-btn"}," 跳转 ",8,Ms)])],10,rs))),128))])):(n(),l("div",Ts,a[9]||(a[9]=[e("div",{class:"placeholder-icon"},"💬",-1),e("div",{class:"placeholder-text"},[e("p",null,"输入关键词搜索消息"),e("p",{class:"placeholder-hint"},"支持搜索文本内容")],-1)])))])])])):_("",!0)}}),Cs=J(ws,[["__scopeId","data-v-5c1dcdcb"]]),Is={class:"message-area-enhanced"},Ss={class:"message-toolbar"},xs=["disabled"],Rs={class:"toolbar-info"},Ds={key:0},Es={class:"message-count"},Hs={key:0,class:"loading-more"},Ns={class:"messages-list"},Bs={key:1,class:"scroll-to-bottom"},Fs={key:0,class:"unread-badge"},Ls={key:0,class:"typing-indicator"},js={class:"typing-text"},zs=A({__name:"MatrixMessageAreaEnhanced",props:{roomId:{}},setup(V){const w=V,r=Q(),f=v(),M=v(!1),h=v(!1),y=v(!1),c=v(0),C=v(null),T=v([]),H=v(0),R=v(!1),D=O(()=>r.rooms.find(i=>i.id===w.roomId)),E=O(()=>r.messages.get(w.roomId)||[]),L=O(()=>D.value?.encrypted||!1);ee(E,(i,m)=>{i.length>(m?.length||0)&&q(()=>{if(!R.value)x();else{const I=i.length-(m?.length||0);c.value+=I,y.value=!0}})},{deep:!0});const B=()=>{if(!f.value)return;const i=f.value,m=i.scrollTop,I=i.scrollHeight,W=i.clientHeight;m<100&&!h.value&&F();const K=I-m-W<100;y.value=!K,K&&(c.value=0),R.value=Math.abs(m-H.value)>10,H.value=m},F=async()=>{if(!h.value){h.value=!0;try{const i=f.value,m=i?.scrollHeight||0;await r.loadMoreHistoryMessages(w.roomId),q(()=>{if(i){const I=i.scrollHeight;i.scrollTop=I-m}})}catch(i){console.error("加载历史消息失败:",i)}finally{h.value=!1}}},x=()=>{q(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight,y.value=!1,c.value=0,R.value=!1)})},o=async(i,m)=>{try{m?.replyTo?await r.sendReplyMessage(w.roomId,i,m.replyTo):await r.sendMessage(w.roomId,i,m?.encrypted),x()}catch(I){console.error("发送消息失败:",I)}},t=i=>{C.value=i},b=()=>{C.value=null},p=i=>{console.log("滚动到消息:",i)},a=(i,m)=>{m&&m!==w.roomId?console.log("跳转到其他房间的消息:",i,m):p(i)},u=()=>{r.sendTypingNotification(w.roomId,!0)},$=()=>{r.sendTypingNotification(w.roomId,!1)},k=i=>i.length===1?i[0]:i.length===2?i.join(" 和 "):`${i.slice(0,2).join("、")} 等 ${i.length} 人`;return se(async()=>{try{await r.fetchMatrixMessages(w.roomId),x()}catch(i){console.error("加载消息失败:",i)}}),de(()=>{$()}),(i,m)=>(n(),l("div",Is,[Z(Cs,{visible:M.value,"room-id":i.roomId,onClose:m[0]||(m[0]=I=>M.value=!1),onJumpToMessage:a},null,8,["visible","room-id"]),e("div",Ss,[e("button",{onClick:m[1]||(m[1]=I=>M.value=!0),class:"toolbar-btn",title:"搜索消息"}," 🔍 "),e("button",{onClick:F,class:"toolbar-btn",title:"加载更多历史",disabled:h.value}," 📚 ",8,xs),e("div",Rs,[D.value?(n(),l("span",Ds,g(D.value.name),1)):_("",!0),e("span",Es,g(E.value.length)+" 条消息",1)])]),e("div",{ref_key:"messagesContainer",ref:f,class:"messages-container",onScroll:B},[h.value?(n(),l("div",Hs,m[2]||(m[2]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"加载历史消息中...",-1)]))):_("",!0),e("div",Ns,[(n(!0),l(z,null,U(E.value,I=>(n(),te(Ae,{key:I.eventId||I.id,message:I,"room-id":i.roomId,onReplyTo:t,onScrollTo:p},null,8,["message","room-id"]))),128))]),y.value?(n(),l("div",Bs,[e("button",{onClick:x,class:"scroll-btn"},[m[3]||(m[3]=e("span",{class:"scroll-icon"},"↓",-1)),c.value>0?(n(),l("span",Fs,g(c.value),1)):_("",!0)])])):_("",!0)],544),Z(pe,{"room-id":i.roomId,"replying-to":C.value,"supports-encryption":L.value,onSendMessage:o,onCancelReply:b,onTypingStart:u,onTypingStop:$},null,8,["room-id","replying-to","supports-encryption"]),T.value.length>0?(n(),l("div",Ls,[m[4]||(m[4]=e("div",{class:"typing-animation"},[e("span"),e("span"),e("span")],-1)),e("span",js,g(k(T.value))+" 正在输入... ",1)])):_("",!0)]))}}),Us=J(zs,[["__scopeId","data-v-103b90ac"]]),Vs={class:"message-features-test"},Ks={class:"test-content"},Os={class:"status-panel"},Ps={class:"feature-list"},qs={class:"test-panel"},As={class:"test-section"},Qs={class:"test-buttons"},Js=["disabled"],Ws=["disabled"],Xs=["disabled"],Gs={class:"test-section"},Ys={class:"search-test"},Zs={key:0,class:"search-results"},et={class:"result-content"},st={class:"result-meta"},tt={class:"test-section"},ot={key:0,class:"performance-results"},at={class:"message-demo"},nt={class:"demo-room"},lt={key:1,class:"no-room"},rt=A({__name:"MessageFeaturesTestPage",setup(V){const w=me(),r=Q(),f=v(""),M=v(""),h=v([]),y=v(""),c=v(""),C=()=>{w.back()},T=async()=>{if(!c.value){alert("请先初始化演示房间");return}try{const o=`测试消息 - ${new Date().toLocaleTimeString()}`;await r.sendMessage(c.value,o);const t=r.messages.get(c.value)||[];t.length>0&&(f.value=t[t.length-1].eventId||""),console.log("✅ 测试消息发送成功")}catch(o){console.error("❌ 测试消息发送失败:",o),alert("发送消息失败: "+o)}},H=async()=>{if(!(!f.value||!c.value))try{const o=`编辑后的消息 - ${new Date().toLocaleTimeString()}`;await r.editMessage(c.value,f.value,o),console.log("✅ 消息编辑测试成功")}catch(o){console.error("❌ 消息编辑测试失败:",o),alert("编辑消息失败: "+o)}},R=async()=>{if(!(!f.value||!c.value))try{await r.deleteMessage(c.value,f.value,"测试删除"),console.log("✅ 消息删除测试成功"),f.value=""}catch(o){console.error("❌ 消息删除测试失败:",o),alert("删除消息失败: "+o)}},D=async()=>{if(!(!f.value||!c.value))try{const o=["👍","❤️","😂","🎉","🔥"],t=o[Math.floor(Math.random()*o.length)];await r.addReaction(c.value,f.value,t),console.log("✅ 反应添加测试成功")}catch(o){console.error("❌ 反应添加测试失败:",o),alert("添加反应失败: "+o)}},E=async()=>{if(!(!M.value.trim()||!c.value))try{const o=performance.now(),t=await r.searchMessages(c.value,M.value),b=performance.now();h.value=t,console.log(`✅ 搜索测试完成，耗时 ${(b-o).toFixed(2)}ms`)}catch(o){console.error("❌ 搜索测试失败:",o),alert("搜索失败: "+o)}},L=async()=>{if(c.value)try{const o=performance.now();await r.loadMoreHistoryMessages(c.value);const t=performance.now(),b=r.messages.get(c.value)||[];y.value=`消息加载性能测试:
- 加载时间: ${(t-o).toFixed(2)}ms
- 消息数量: ${b.length}
- 平均加载速度: ${(b.length/(t-o)*1e3).toFixed(2)} 条/秒`,console.log("✅ 消息加载性能测试完成")}catch(o){console.error("❌ 消息加载性能测试失败:",o)}},B=async()=>{if(c.value)try{const o=["测试","hello","matrix","消息","test"],t=[];for(const a of o){const u=performance.now(),$=await r.searchMessages(c.value,a),k=performance.now();t.push({query:a,time:k-u,count:$.length})}const b=t.reduce((a,u)=>a+u.time,0)/t.length,p=t.reduce((a,u)=>a+u.count,0);y.value=`搜索性能测试:
- 测试查询数: ${o.length}
- 平均搜索时间: ${b.toFixed(2)}ms
- 总结果数: ${p}
- 搜索效率: ${(p/b*1e3).toFixed(2)} 结果/秒

详细结果:
${t.map(a=>`  "${a.query}": ${a.time.toFixed(2)}ms (${a.count}条)`).join(`
`)}`,console.log("✅ 搜索性能测试完成")}catch(o){console.error("❌ 搜索性能测试失败:",o)}},F=async()=>{try{const o=r.rooms;o.length>0?(c.value=o[0].id,console.log("✅ 演示房间初始化成功:",c.value)):alert("没有可用的房间，请先加入一个房间")}catch(o){console.error("❌ 演示房间初始化失败:",o),alert("初始化失败: "+o)}},x=o=>new Date(o).toLocaleString("zh-CN");return se(()=>{r.rooms.length>0&&(c.value=r.rooms[0].id)}),(o,t)=>(n(),l("div",Vs,[e("div",{class:"test-header"},[t[1]||(t[1]=e("h1",null,"💬 Matrix消息功能测试",-1)),e("button",{onClick:C,class:"back-btn"},"← 返回")]),e("div",Ks,[e("div",Os,[t[9]||(t[9]=e("h3",null,"功能实现状态",-1)),e("div",Ps,[e("div",{class:N(["feature-item",{implemented:!0}])},t[2]||(t[2]=[e("span",{class:"feature-icon"},"✅",-1),e("span",{class:"feature-name"},"消息回复",-1),e("span",{class:"feature-desc"},"支持回复引用消息",-1)])),e("div",{class:N(["feature-item",{implemented:!0}])},t[3]||(t[3]=[e("span",{class:"feature-icon"},"✅",-1),e("span",{class:"feature-name"},"消息编辑",-1),e("span",{class:"feature-desc"},"编辑已发送的消息",-1)])),e("div",{class:N(["feature-item",{implemented:!0}])},t[4]||(t[4]=[e("span",{class:"feature-icon"},"✅",-1),e("span",{class:"feature-name"},"消息删除",-1),e("span",{class:"feature-desc"},"删除/撤回消息",-1)])),e("div",{class:N(["feature-item",{implemented:!0}])},t[5]||(t[5]=[e("span",{class:"feature-icon"},"✅",-1),e("span",{class:"feature-name"},"消息反应",-1),e("span",{class:"feature-desc"},"添加emoji反应",-1)])),e("div",{class:N(["feature-item",{implemented:!0}])},t[6]||(t[6]=[e("span",{class:"feature-icon"},"✅",-1),e("span",{class:"feature-name"},"消息搜索",-1),e("span",{class:"feature-desc"},"搜索历史消息",-1)])),e("div",{class:N(["feature-item",{implemented:!0}])},t[7]||(t[7]=[e("span",{class:"feature-icon"},"✅",-1),e("span",{class:"feature-name"},"消息分页",-1),e("span",{class:"feature-desc"},"历史消息分页加载",-1)])),e("div",{class:N(["feature-item",{implemented:!0}])},t[8]||(t[8]=[e("span",{class:"feature-icon"},"✅",-1),e("span",{class:"feature-name"},"输入状态",-1),e("span",{class:"feature-desc"},"显示正在输入状态",-1)]))])]),t[17]||(t[17]=ue('<div class="compatibility-panel" data-v-89838802><h3 data-v-89838802>Matrix协议兼容性</h3><div class="protocol-list" data-v-89838802><div class="protocol-item" data-v-89838802><span class="protocol-name" data-v-89838802>m.room.message</span><span class="protocol-status supported" data-v-89838802>✅ 支持</span><span class="protocol-desc" data-v-89838802>基础消息发送</span></div><div class="protocol-item" data-v-89838802><span class="protocol-name" data-v-89838802>m.replace</span><span class="protocol-status supported" data-v-89838802>✅ 支持</span><span class="protocol-desc" data-v-89838802>消息编辑事件</span></div><div class="protocol-item" data-v-89838802><span class="protocol-name" data-v-89838802>m.room.redaction</span><span class="protocol-status supported" data-v-89838802>✅ 支持</span><span class="protocol-desc" data-v-89838802>消息删除事件</span></div><div class="protocol-item" data-v-89838802><span class="protocol-name" data-v-89838802>m.reaction</span><span class="protocol-status supported" data-v-89838802>✅ 支持</span><span class="protocol-desc" data-v-89838802>消息反应事件</span></div><div class="protocol-item" data-v-89838802><span class="protocol-name" data-v-89838802>m.in_reply_to</span><span class="protocol-status supported" data-v-89838802>✅ 支持</span><span class="protocol-desc" data-v-89838802>消息回复关系</span></div><div class="protocol-item" data-v-89838802><span class="protocol-name" data-v-89838802>m.typing</span><span class="protocol-status supported" data-v-89838802>✅ 支持</span><span class="protocol-desc" data-v-89838802>输入状态通知</span></div></div></div>',1)),e("div",qs,[t[14]||(t[14]=e("h3",null,"功能测试",-1)),e("div",As,[t[10]||(t[10]=e("h4",null,"消息操作测试",-1)),e("div",Qs,[e("button",{onClick:T,class:"test-btn"}," 📤 发送测试消息 "),e("button",{onClick:H,class:"test-btn",disabled:!f.value}," ✏️ 编辑最后消息 ",8,Js),e("button",{onClick:R,class:"test-btn",disabled:!f.value}," 🗑️ 删除最后消息 ",8,Ws),e("button",{onClick:D,class:"test-btn",disabled:!f.value}," 😊 添加反应 ",8,Xs)])]),e("div",Gs,[t[11]||(t[11]=e("h4",null,"搜索功能测试",-1)),e("div",Ys,[P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=b=>M.value=b),placeholder:"输入搜索关键词...",class:"search-input"},null,512),[[G,M.value]]),e("button",{onClick:E,class:"test-btn"}," 🔍 搜索消息 ")]),h.value.length>0?(n(),l("div",Zs,[e("h5",null,"搜索结果 ("+g(h.value.length)+" 条):",1),(n(!0),l(z,null,U(h.value,b=>(n(),l("div",{key:b.result.event_id,class:"search-result-item"},[e("div",et,g(b.result.content.body),1),e("div",st,g(x(b.result.origin_server_ts)),1)]))),128))])):_("",!0)]),e("div",tt,[t[13]||(t[13]=e("h4",null,"性能测试",-1)),e("div",{class:"performance-test"},[e("button",{onClick:L,class:"test-btn"}," 📊 测试消息加载性能 "),e("button",{onClick:B,class:"test-btn"}," ⚡ 测试搜索性能 ")]),y.value?(n(),l("div",ot,[t[12]||(t[12]=e("h5",null,"性能测试结果:",-1)),e("pre",null,g(y.value),1)])):_("",!0)])]),e("div",at,[t[16]||(t[16]=e("h3",null,"实时消息演示",-1)),e("div",nt,[c.value?(n(),te(Us,{key:0,"room-id":c.value},null,8,["room-id"])):(n(),l("div",lt,[t[15]||(t[15]=e("p",null,"请先登录Matrix账户并加入房间",-1)),e("button",{onClick:F,class:"init-btn"}," 🏠 初始化演示房间 ")]))])])])]))}}),ut=J(rt,[["__scopeId","data-v-89838802"]]);export{ut as default};
