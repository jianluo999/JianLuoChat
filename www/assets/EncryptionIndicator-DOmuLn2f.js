import{j as U,g as B,h as c,c as d,b as u,n as D,m as a,a as i,l as y,D as b,E as o,t as s,e as l,o as r,G as _,B as w,Q as T,R as W,_ as G}from"./index-Cl5nGqgc.js";const j={class:"encryption-indicator"},Q={class:"encryption-text"},q={key:1,class:"encryption-details"},A={class:"detail-item"},F={key:0,class:"detail-item"},H={key:1,class:"detail-item"},J={key:2,class:"detail-item"},M={key:3,class:"detail-item"},O={key:4,class:"detail-actions"},P=["title"],X={class:"encryption-text"},Y={class:"encryption-text"},Z={class:"global-encryption-details"},h={class:"detail-item"},x={class:"detail-item"},ee={class:"detail-item"},te={class:"detail-item"},ne={class:"global-actions"},ie=U({__name:"EncryptionIndicator",props:{type:{},encrypted:{type:Boolean,default:!1},verified:{type:Boolean,default:!1},algorithm:{},memberCount:{},verifiedDevices:{},totalDevices:{},lastKeyRotation:{},canVerify:{type:Boolean,default:!0},cryptoEngine:{default:"Rust Crypto"},deviceId:{},globalVerifiedDevices:{default:0},keyBackupEnabled:{type:Boolean,default:!1},decrypted:{type:Boolean,default:!0},decryptionError:{}},emits:["verify-device","manage-encryption"],setup(I){const e=I,C=B(!1),f=B(!1),m=c(()=>{if(e.type==="message")return e.encrypted?e.decryptionError?"decryption-error":e.decrypted?"encrypted":"decrypting":"unencrypted";if(e.type==="device")return e.verified?"verified":"unverified";if(e.type==="global")return e.encrypted?"crypto-enabled":"crypto-disabled";if(!e.encrypted)return"unencrypted";if(e.verifiedDevices!==null&&e.totalDevices!==null){const n=e.verifiedDevices/e.totalDevices;return n===1?"fully-verified":n>.5?"partially-verified":"unverified"}return"encrypted"}),g=c(()=>{if(e.type==="message")return e.encrypted?e.decryptionError?"Warning":"Lock":"Unlock";if(e.type==="device")return e.verified?"Shield":"Warning";if(e.type==="global")return e.encrypted?"Shield":"Unlock";if(!e.encrypted)return"Unlock";if(e.verifiedDevices!==null&&e.totalDevices!==null){const n=e.verifiedDevices/e.totalDevices;return n===1?"Shield":n>.5?"Lock":"Warning"}return"Lock"}),E=c(()=>{if(e.type==="message")return e.encrypted?e.decryptionError?"解密失败":e.decrypted?"已加密":"解密中...":"未加密";if(e.type==="device")return e.verified?"已验证":"未验证";if(e.type==="global")return e.encrypted?"加密已启用":"加密未启用";if(!e.encrypted)return"未加密房间";if(e.verifiedDevices!==null&&e.totalDevices!==null){const n=e.verifiedDevices/e.totalDevices;return n===1?"完全验证":n>.5?"部分验证":"未验证设备"}return"加密房间"}),V=c(()=>e.encrypted?"此房间已启用端到端加密，消息仅对房间成员可见":"此房间未启用端到端加密"),$=c(()=>e.encrypted?e.decryptionError?`解密失败: ${e.decryptionError}`:"此消息已端到端加密":"此消息未加密"),z=c(()=>e.type==="room"&&e.encrypted),S=n=>n.toLocaleString(),R=()=>{console.log("管理密钥")},K=()=>{console.log("验证设备")};return(n,t)=>{const p=b("el-icon"),k=b("el-button"),L=b("el-tag"),N=b("el-popover");return r(),d("div",j,[n.type==="room"?(r(),d("div",{key:0,class:D(["room-encryption-status",m.value]),onClick:t[0]||(t[0]=v=>C.value=!C.value)},[a(p,{class:"encryption-icon"},{default:o(()=>[(r(),y(_(g.value)))]),_:1}),i("span",Q,s(E.value),1),z.value?(r(),y(p,{key:0,class:"expand-icon"},{default:o(()=>[a(w(T))]),_:1})):u("",!0),C.value?(r(),d("div",q,[i("div",A,[t[5]||(t[5]=i("strong",null,"加密状态:",-1)),l(" "+s(V.value),1)]),n.algorithm?(r(),d("div",F,[t[6]||(t[6]=i("strong",null,"加密算法:",-1)),l(" "+s(n.algorithm),1)])):u("",!0),n.memberCount?(r(),d("div",H,[t[7]||(t[7]=i("strong",null,"房间成员:",-1)),l(" "+s(n.memberCount)+" 人 ",1)])):u("",!0),n.verifiedDevices!==null?(r(),d("div",J,[t[8]||(t[8]=i("strong",null,"已验证设备:",-1)),l(" "+s(n.verifiedDevices)+"/"+s(n.totalDevices),1)])):u("",!0),n.lastKeyRotation?(r(),d("div",M,[t[9]||(t[9]=i("strong",null,"最后密钥轮换:",-1)),l(" "+s(S(n.lastKeyRotation)),1)])):u("",!0),n.encrypted?(r(),d("div",O,[a(k,{size:"small",onClick:R},{default:o(()=>t[10]||(t[10]=[l(" 管理密钥 ")])),_:1,__:[10]}),a(k,{size:"small",onClick:K},{default:o(()=>t[11]||(t[11]=[l(" 验证设备 ")])),_:1,__:[11]})])):u("",!0)])):u("",!0)],2)):n.type==="message"?(r(),d("div",{key:1,class:D(["message-encryption-status",m.value]),title:$.value},[a(p,{class:"encryption-icon"},{default:o(()=>[(r(),y(_(g.value)))]),_:1})],10,P)):n.type==="device"?(r(),d("div",{key:2,class:D(["device-encryption-status",m.value])},[a(p,{class:"encryption-icon"},{default:o(()=>[(r(),y(_(g.value)))]),_:1}),i("span",X,s(E.value),1),!n.verified&&n.canVerify?(r(),y(k,{key:0,size:"small",type:"primary",onClick:t[1]||(t[1]=v=>n.$emit("verify-device"))},{default:o(()=>t[12]||(t[12]=[l(" 验证 ")])),_:1,__:[12]})):u("",!0)],2)):n.type==="global"?(r(),d("div",{key:3,class:D(["global-encryption-status",m.value]),onClick:t[4]||(t[4]=v=>f.value=!f.value)},[a(p,{class:"encryption-icon"},{default:o(()=>[(r(),y(_(g.value)))]),_:1}),i("span",Y,s(E.value),1),a(N,{visible:f.value,"onUpdate:visible":t[3]||(t[3]=v=>f.value=v),placement:"bottom",width:"300",trigger:"click"},{reference:o(()=>[a(p,{class:"expand-icon"},{default:o(()=>[a(w(W))]),_:1})]),default:o(()=>[i("div",Z,[t[18]||(t[18]=i("h4",null,"端到端加密状态",-1)),i("div",h,[t[13]||(t[13]=i("strong",null,"加密引擎:",-1)),l(" "+s(n.cryptoEngine),1)]),i("div",x,[t[14]||(t[14]=i("strong",null,"设备ID:",-1)),l(" "+s(n.deviceId),1)]),i("div",ee,[t[15]||(t[15]=i("strong",null,"已验证设备:",-1)),l(" "+s(n.globalVerifiedDevices),1)]),i("div",te,[t[16]||(t[16]=i("strong",null,"密钥备份:",-1)),a(L,{type:n.keyBackupEnabled?"success":"warning",size:"small"},{default:o(()=>[l(s(n.keyBackupEnabled?"已启用":"未启用"),1)]),_:1},8,["type"])]),i("div",ne,[a(k,{size:"small",onClick:t[2]||(t[2]=v=>n.$emit("manage-encryption"))},{default:o(()=>t[17]||(t[17]=[l(" 管理加密 ")])),_:1,__:[17]})])])]),_:1},8,["visible"])],2)):u("",!0)])}}}),oe=G(ie,[["__scopeId","data-v-7c2e5a58"]]);export{oe as E};
