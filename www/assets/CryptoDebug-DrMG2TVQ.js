import{j as K,f as V,g as C,y as $,c as u,a as e,m as n,l as p,b,E as o,D as S,K as E,n as _,G as m,t as r,e as x,F as D,r as I,B as j,R as H,o as a,_ as z}from"./index-Cl5nGqgc.js";const G={class:"crypto-debug"},J={class:"check-list"},O={class:"check-item"},U={class:"check-item"},q={class:"check-item"},Q={class:"check-item"},X={class:"check-item"},Y={class:"check-item"},Z={class:"actions"},ee={class:"test-actions"},se={key:0,class:"test-results"},te={class:"result-content"},le={class:"result-title"},ae={class:"result-message"},oe={key:0,class:"result-details"},ie={class:"error-logs"},ne={class:"log-time"},re={class:"log-message"},ce={key:0,class:"log-stack"},ue={class:"actions"},de={class:"suggestions"},ve={class:"suggestion-content"},pe={key:0,class:"suggestion-steps"},ye=K({__name:"CryptoDebug",setup(_e){const f=V(),F=C(!1),d=C({init:!1,keys:!1,export:!1}),t=C({webAssembly:!1,indexedDB:!1,webCrypto:!1,secureContext:!1,matrixClient:!1,cryptoAPI:!1}),v=C([]),k=C([]),g=C([]),B=async()=>{F.value=!0;try{if(t.value.webAssembly=typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function",t.value.indexedDB="indexedDB"in window&&indexedDB!==null,t.value.webCrypto="crypto"in window&&"subtle"in window.crypto,t.value.secureContext=window.isSecureContext,t.value.matrixClient=!!f.matrixClient,f.matrixClient){const s=f.matrixClient.getCrypto();t.value.cryptoAPI=!!s}N(),E.success("çŽ¯å¢ƒæ£€æŸ¥å®Œæˆ")}catch(s){console.error("çŽ¯å¢ƒæ£€æŸ¥å¤±è´¥:",s),w("çŽ¯å¢ƒæ£€æŸ¥å¤±è´¥",s),E.error("çŽ¯å¢ƒæ£€æŸ¥å¤±è´¥")}finally{F.value=!1}},R=async()=>{d.value.init=!0;try{const s=f.matrixClient;if(!s)throw new Error("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–");if(typeof s.initRustCrypto=="function")await s.initRustCrypto({useIndexedDB:!1}),v.value.push({title:"åŠ å¯†åˆå§‹åŒ–æµ‹è¯•",message:"æˆåŠŸåˆå§‹åŒ–RuståŠ å¯†å¼•æ“Ž",success:!0,details:{method:"initRustCrypto",storage:"memory"}});else throw new Error("å®¢æˆ·ç«¯ä¸æ”¯æŒRuståŠ å¯†åˆå§‹åŒ–")}catch(s){console.error("åŠ å¯†åˆå§‹åŒ–æµ‹è¯•å¤±è´¥:",s),w("åŠ å¯†åˆå§‹åŒ–æµ‹è¯•å¤±è´¥",s),v.value.push({title:"åŠ å¯†åˆå§‹åŒ–æµ‹è¯•",message:`å¤±è´¥: ${s.message}`,success:!1})}finally{d.value.init=!1}},M=async()=>{d.value.keys=!0;try{const s=f.matrixClient;if(!s)throw new Error("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–");if(!s.getCrypto())throw new Error("åŠ å¯†APIä¸å¯ç”¨");const c=s.getDeviceId(),y=s.getUserId();v.value.push({title:"è®¾å¤‡å¯†é’¥æµ‹è¯•",message:"æˆåŠŸèŽ·å–è®¾å¤‡ä¿¡æ¯",success:!0,details:{deviceId:c,userId:y,cryptoAvailable:!0}})}catch(s){console.error("è®¾å¤‡å¯†é’¥æµ‹è¯•å¤±è´¥:",s),w("è®¾å¤‡å¯†é’¥æµ‹è¯•å¤±è´¥",s),v.value.push({title:"è®¾å¤‡å¯†é’¥æµ‹è¯•",message:`å¤±è´¥: ${s.message}`,success:!1})}finally{d.value.keys=!1}},T=async()=>{d.value.export=!0;try{const s=f.matrixClient;if(!s)throw new Error("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–");const l=s.getCrypto();if(!l)throw new Error("åŠ å¯†APIä¸å¯ç”¨");const c=await l.exportRoomKeys();v.value.push({title:"å¯†é’¥å¯¼å‡ºæµ‹è¯•",message:`æˆåŠŸå¯¼å‡º ${c.length} ä¸ªæˆ¿é—´å¯†é’¥`,success:!0,details:{keyCount:c.length}})}catch(s){console.error("å¯†é’¥å¯¼å‡ºæµ‹è¯•å¤±è´¥:",s),w("å¯†é’¥å¯¼å‡ºæµ‹è¯•å¤±è´¥",s),v.value.push({title:"å¯†é’¥å¯¼å‡ºæµ‹è¯•",message:`å¤±è´¥: ${s.message}`,success:!1})}finally{d.value.export=!1}},w=(s,l)=>{k.value.push({time:Date.now(),message:s,stack:l.stack})},W=()=>{k.value=[],v.value=[]},L=s=>new Date(s).toLocaleTimeString(),N=()=>{g.value=[],t.value.webAssembly||g.value.push({title:"WebAssemblyä¸æ”¯æŒ",description:"æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebAssemblyï¼Œè¿™æ˜¯åŠ å¯†åŠŸèƒ½çš„å¿…è¦æ¡ä»¶",steps:["æ›´æ–°æµè§ˆå™¨åˆ°æœ€æ–°ç‰ˆæœ¬","ä½¿ç”¨Chromeã€Firefoxæˆ–Safariæµè§ˆå™¨","æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ä¸­æ˜¯å¦ç¦ç”¨äº†WebAssembly"]}),t.value.secureContext||g.value.push({title:"éžå®‰å…¨ä¸Šä¸‹æ–‡",description:"åŠ å¯†åŠŸèƒ½éœ€è¦åœ¨HTTPSæˆ–localhostçŽ¯å¢ƒä¸‹è¿è¡Œ",steps:["ä½¿ç”¨HTTPSè®¿é—®ç½‘ç«™","æˆ–åœ¨localhostçŽ¯å¢ƒä¸‹æµ‹è¯•","æ£€æŸ¥æµè§ˆå™¨åœ°å€æ æ˜¯å¦æ˜¾ç¤ºå®‰å…¨é”å›¾æ ‡"]}),t.value.indexedDB||g.value.push({title:"IndexedDBä¸å¯ç”¨",description:"æµè§ˆå™¨å­˜å‚¨åŠŸèƒ½ä¸å¯ç”¨ï¼Œå¯èƒ½å½±å“å¯†é’¥æŒä¹…åŒ–",steps:["æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å¤„äºŽéšç§æ¨¡å¼","æ¸…é™¤æµè§ˆå™¨æ•°æ®å¹¶é‡è¯•","æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨è®¾ç½®"]})};return $(()=>{B()}),(s,l)=>{const c=S("el-icon"),y=S("el-button"),A=S("el-card");return a(),u("div",G,[l[10]||(l[10]=e("div",{class:"debug-header"},[e("h1",null,"ðŸ” åŠ å¯†åŠŸèƒ½è°ƒè¯•"),e("p",null,"æ£€æŸ¥å’Œè°ƒè¯•ç«¯åˆ°ç«¯åŠ å¯†åŠŸèƒ½")],-1)),n(A,{class:"debug-card"},{header:o(()=>l[0]||(l[0]=[e("span",null,"çŽ¯å¢ƒæ£€æŸ¥",-1)])),default:o(()=>[e("div",J,[e("div",O,[n(c,{class:_(t.value.webAssembly?"success":"error")},{default:o(()=>[(a(),p(m(t.value.webAssembly?"SuccessFilled":"CircleCloseFilled")))]),_:1},8,["class"]),e("span",null,"WebAssemblyæ”¯æŒ: "+r(t.value.webAssembly?"âœ…":"âŒ"),1)]),e("div",U,[n(c,{class:_(t.value.indexedDB?"success":"error")},{default:o(()=>[(a(),p(m(t.value.indexedDB?"SuccessFilled":"CircleCloseFilled")))]),_:1},8,["class"]),e("span",null,"IndexedDBæ”¯æŒ: "+r(t.value.indexedDB?"âœ…":"âŒ"),1)]),e("div",q,[n(c,{class:_(t.value.webCrypto?"success":"error")},{default:o(()=>[(a(),p(m(t.value.webCrypto?"SuccessFilled":"CircleCloseFilled")))]),_:1},8,["class"]),e("span",null,"Web Crypto API: "+r(t.value.webCrypto?"âœ…":"âŒ"),1)]),e("div",Q,[n(c,{class:_(t.value.secureContext?"success":"error")},{default:o(()=>[(a(),p(m(t.value.secureContext?"SuccessFilled":"CircleCloseFilled")))]),_:1},8,["class"]),e("span",null,"å®‰å…¨ä¸Šä¸‹æ–‡: "+r(t.value.secureContext?"âœ…":"âŒ"),1)]),e("div",X,[n(c,{class:_(t.value.matrixClient?"success":"error")},{default:o(()=>[(a(),p(m(t.value.matrixClient?"SuccessFilled":"CircleCloseFilled")))]),_:1},8,["class"]),e("span",null,"Matrixå®¢æˆ·ç«¯: "+r(t.value.matrixClient?"âœ…":"âŒ"),1)]),e("div",Y,[n(c,{class:_(t.value.cryptoAPI?"success":"error")},{default:o(()=>[(a(),p(m(t.value.cryptoAPI?"SuccessFilled":"CircleCloseFilled")))]),_:1},8,["class"]),e("span",null,"åŠ å¯†API: "+r(t.value.cryptoAPI?"âœ…":"âŒ"),1)])]),e("div",Z,[n(y,{onClick:B,loading:F.value},{default:o(()=>l[1]||(l[1]=[x(" é‡æ–°æ£€æŸ¥çŽ¯å¢ƒ ")])),_:1,__:[1]},8,["loading"])])]),_:1}),n(A,{class:"debug-card"},{header:o(()=>l[2]||(l[2]=[e("span",null,"åŠ å¯†åŠŸèƒ½æµ‹è¯•",-1)])),default:o(()=>[e("div",ee,[n(y,{onClick:R,loading:d.value.init,disabled:!t.value.matrixClient},{default:o(()=>l[3]||(l[3]=[x(" æµ‹è¯•åŠ å¯†åˆå§‹åŒ– ")])),_:1,__:[3]},8,["loading","disabled"]),n(y,{onClick:M,loading:d.value.keys,disabled:!t.value.cryptoAPI},{default:o(()=>l[4]||(l[4]=[x(" æµ‹è¯•è®¾å¤‡å¯†é’¥ ")])),_:1,__:[4]},8,["loading","disabled"]),n(y,{onClick:T,loading:d.value.export,disabled:!t.value.cryptoAPI},{default:o(()=>l[5]||(l[5]=[x(" æµ‹è¯•å¯†é’¥å¯¼å‡º ")])),_:1,__:[5]},8,["loading","disabled"])]),v.value.length>0?(a(),u("div",se,[l[6]||(l[6]=e("h4",null,"æµ‹è¯•ç»“æžœ:",-1)),(a(!0),u(D,null,I(v.value,(i,h)=>(a(),u("div",{key:h,class:_(["test-result",{success:i.success,error:!i.success}])},[n(c,null,{default:o(()=>[(a(),p(m(i.success?"SuccessFilled":"CircleCloseFilled")))]),_:2},1024),e("div",te,[e("div",le,r(i.title),1),e("div",ae,r(i.message),1),i.details?(a(),u("div",oe,[e("pre",null,r(JSON.stringify(i.details,null,2)),1)])):b("",!0)])],2))),128))])):b("",!0)]),_:1}),k.value.length>0?(a(),p(A,{key:0,class:"debug-card"},{header:o(()=>l[7]||(l[7]=[e("span",null,"é”™è¯¯æ—¥å¿—",-1)])),default:o(()=>[e("div",ie,[(a(!0),u(D,null,I(k.value,(i,h)=>(a(),u("div",{key:h,class:"error-log"},[e("div",ne,r(L(i.time)),1),e("div",re,r(i.message),1),i.stack?(a(),u("div",ce,[e("pre",null,r(i.stack),1)])):b("",!0)]))),128))]),e("div",ue,[n(y,{onClick:W},{default:o(()=>l[8]||(l[8]=[x("æ¸…é™¤æ—¥å¿—")])),_:1,__:[8]})])]),_:1})):b("",!0),g.value.length>0?(a(),p(A,{key:1,class:"debug-card"},{header:o(()=>l[9]||(l[9]=[e("span",null,"è§£å†³æ–¹æ¡ˆå»ºè®®",-1)])),default:o(()=>[e("div",de,[(a(!0),u(D,null,I(g.value,(i,h)=>(a(),u("div",{key:h,class:"suggestion"},[n(c,{class:"suggestion-icon"},{default:o(()=>[n(j(H))]),_:1}),e("div",ve,[e("h4",null,r(i.title),1),e("p",null,r(i.description),1),i.steps?(a(),u("div",pe,[e("ol",null,[(a(!0),u(D,null,I(i.steps,P=>(a(),u("li",{key:P},r(P),1))),128))])])):b("",!0)])]))),128))])]),_:1})):b("",!0)])}}}),fe=z(ye,[["__scopeId","data-v-0bed1ecc"]]);export{fe as default};
