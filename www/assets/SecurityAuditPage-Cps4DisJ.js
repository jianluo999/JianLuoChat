import{j as K,f as L,g as A,h as B,y as V,c as h,a as s,b as _,m,l as N,E as g,D as b,e as S,B as C,S as O,t as u,H as F,F as E,r as x,n as q,R as J,o as d,K as k,_ as G}from"./index-Cl5nGqgc.js";class Q{client=null;constructor(t){this.client=t}async performSecurityAudit(){const t=[];console.log("ğŸ” å¼€å§‹E2EEå®‰å…¨æ£€æŸ¥..."),t.push(...await this.checkBasicEnvironment()),t.push(...await this.checkMatrixClient()),t.push(...await this.checkCryptoInitialization()),t.push(...await this.checkKeyManagement()),t.push(...await this.checkDeviceVerification()),t.push(...await this.checkMessageEncryption()),t.push(...await this.checkSecurityConfiguration());const a=t.filter(l=>l.severity==="critical"&&l.status==="fail").length,e=t.filter(l=>l.severity==="high"&&l.status==="fail").length,n=t.filter(l=>l.severity==="medium"&&l.status==="fail").length,o=t.filter(l=>l.severity==="low"&&l.status==="fail").length;let y="secure";a>0?y="critical":e>0&&(y="vulnerable");const c={timestamp:Date.now(),overallStatus:y,criticalIssues:a,highIssues:e,mediumIssues:n,lowIssues:o,results:t};return console.log("ğŸ“Š å®‰å…¨æ£€æŸ¥å®Œæˆ:",{æ€»ä½“çŠ¶æ€:y,ä¸¥é‡é—®é¢˜:a,é«˜é£é™©é—®é¢˜:e,ä¸­é£é™©é—®é¢˜:n,ä½é£é™©é—®é¢˜:o}),c}async checkBasicEnvironment(){const t=[];t.push({category:"åŸºç¡€ç¯å¢ƒ",check:"HTTPSè¿æ¥",status:location.protocol==="https:"?"pass":"fail",message:location.protocol==="https:"?"ä½¿ç”¨HTTPSè¿æ¥":"æœªä½¿ç”¨HTTPSè¿æ¥",severity:location.protocol==="https:"?"low":"critical",recommendation:location.protocol!=="https:"?"å¿…é¡»ä½¿ç”¨HTTPSä»¥ç¡®ä¿ä¼ è¾“å®‰å…¨":void 0});const a="crypto"in window&&"subtle"in window.crypto;t.push({category:"åŸºç¡€ç¯å¢ƒ",check:"Web Crypto API",status:a?"pass":"fail",message:a?"Web Crypto APIå¯ç”¨":"Web Crypto APIä¸å¯ç”¨",severity:a?"low":"critical",recommendation:a?void 0:"éœ€è¦æ”¯æŒWeb Crypto APIçš„ç°ä»£æµè§ˆå™¨"});const e="indexedDB"in window&&indexedDB!==null;t.push({category:"åŸºç¡€ç¯å¢ƒ",check:"IndexedDBæ”¯æŒ",status:e?"pass":"fail",message:e?"IndexedDBå¯ç”¨":"IndexedDBä¸å¯ç”¨",severity:e?"low":"high",recommendation:e?void 0:"éœ€è¦æ”¯æŒIndexedDBçš„æµè§ˆå™¨ä»¥å®‰å…¨å­˜å‚¨å¯†é’¥"});const n="WebAssembly"in window;return t.push({category:"åŸºç¡€ç¯å¢ƒ",check:"WebAssemblyæ”¯æŒ",status:n?"pass":"fail",message:n?"WebAssemblyå¯ç”¨":"WebAssemblyä¸å¯ç”¨",severity:n?"low":"high",recommendation:n?void 0:"éœ€è¦æ”¯æŒWebAssemblyçš„æµè§ˆå™¨ä»¥è¿è¡ŒRuståŠ å¯†å¼•æ“"}),t}async checkMatrixClient(){const t=[];if(t.push({category:"Matrixå®¢æˆ·ç«¯",check:"å®¢æˆ·ç«¯åˆå§‹åŒ–",status:this.client?"pass":"fail",message:this.client?"Matrixå®¢æˆ·ç«¯å·²åˆå§‹åŒ–":"Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–",severity:this.client?"low":"critical",recommendation:this.client?void 0:"å¿…é¡»å…ˆåˆå§‹åŒ–Matrixå®¢æˆ·ç«¯"}),!this.client)return t;const a=this.client.getUserId(),e=this.client.getDeviceId();return t.push({category:"Matrixå®¢æˆ·ç«¯",check:"ç”¨æˆ·èº«ä»½",status:a?"pass":"fail",message:a?`ç”¨æˆ·ID: ${a}`:"ç”¨æˆ·IDä¸å¯ç”¨",severity:a?"low":"high"}),t.push({category:"Matrixå®¢æˆ·ç«¯",check:"è®¾å¤‡èº«ä»½",status:e?"pass":"fail",message:e?`è®¾å¤‡ID: ${e}`:"è®¾å¤‡IDä¸å¯ç”¨",severity:e?"low":"high"}),t}async checkCryptoInitialization(){const t=[];if(!this.client)return t.push({category:"åŠ å¯†åˆå§‹åŒ–",check:"åŠ å¯†å¼•æ“",status:"fail",message:"Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–",severity:"critical"}),t;const a=this.client.getCrypto();if(t.push({category:"åŠ å¯†åˆå§‹åŒ–",check:"åŠ å¯†APIå¯ç”¨æ€§",status:a?"pass":"fail",message:a?"åŠ å¯†APIå¯ç”¨":"åŠ å¯†APIä¸å¯ç”¨",severity:a?"low":"critical",recommendation:a?void 0:"éœ€è¦åˆå§‹åŒ–RuståŠ å¯†å¼•æ“"}),!a)return t;const e=["exportRoomKeys","importRoomKeys","getUserDevices","requestDeviceVerification"];for(const n of e){const o=typeof a[n]=="function";t.push({category:"åŠ å¯†åˆå§‹åŒ–",check:`åŠ å¯†æ–¹æ³•: ${n}`,status:o?"pass":"fail",message:o?`${n} æ–¹æ³•å¯ç”¨`:`${n} æ–¹æ³•ä¸å¯ç”¨`,severity:o?"low":"high"})}return t}async checkKeyManagement(){const t=[];if(!this.client)return t;const a=this.client.getCrypto();if(!a)return t;try{const e=await a.getBackupInfo();if(t.push({category:"å¯†é’¥ç®¡ç†",check:"å¯†é’¥å¤‡ä»½",status:e?"pass":"warning",message:e?"å¯†é’¥å¤‡ä»½å·²é…ç½®":"å¯†é’¥å¤‡ä»½æœªé…ç½®",severity:e?"low":"medium",recommendation:e?void 0:"å»ºè®®é…ç½®å¯†é’¥å¤‡ä»½ä»¥é˜²è®¾å¤‡ä¸¢å¤±"}),this.client.getUserId()){const o=await a.getCrossSigningKeyId();t.push({category:"å¯†é’¥ç®¡ç†",check:"äº¤å‰ç­¾å",status:o?"pass":"warning",message:o?"äº¤å‰ç­¾åå·²é…ç½®":"äº¤å‰ç­¾åæœªé…ç½®",severity:o?"low":"medium",recommendation:o?void 0:"å»ºè®®é…ç½®äº¤å‰ç­¾åä»¥ç®€åŒ–è®¾å¤‡éªŒè¯"})}}catch(e){t.push({category:"å¯†é’¥ç®¡ç†",check:"å¯†é’¥ç®¡ç†æ£€æŸ¥",status:"fail",message:`å¯†é’¥ç®¡ç†æ£€æŸ¥å¤±è´¥: ${e.message}`,severity:"high"})}return t}async checkDeviceVerification(){const t=[];if(!this.client)return t;const a=this.client.getCrypto();if(!a)return t;try{const e=this.client.getUserId(),n=this.client.getDeviceId();if(e&&n){const o=await a.getDevice(e,n);t.push({category:"è®¾å¤‡éªŒè¯",check:"å½“å‰è®¾å¤‡éªŒè¯",status:o?.verified?"pass":"warning",message:o?.verified?"å½“å‰è®¾å¤‡å·²éªŒè¯":"å½“å‰è®¾å¤‡æœªéªŒè¯",severity:o?.verified?"low":"medium",recommendation:o?.verified?void 0:"å»ºè®®éªŒè¯å½“å‰è®¾å¤‡ä»¥å¯ç”¨å®Œæ•´çš„E2EEåŠŸèƒ½"});const y=await a.getUserDevices(e),c=Array.from(y.values()).filter(l=>!l.verified&&l.deviceId!==n);t.push({category:"è®¾å¤‡éªŒè¯",check:"å…¶ä»–è®¾å¤‡éªŒè¯",status:c.length===0?"pass":"warning",message:c.length===0?"æ‰€æœ‰è®¾å¤‡å·²éªŒè¯":`${c.length}ä¸ªè®¾å¤‡æœªéªŒè¯`,severity:c.length===0?"low":"medium",recommendation:c.length>0?"å»ºè®®éªŒè¯æ‰€æœ‰è®¾å¤‡ä»¥ç¡®ä¿å®‰å…¨é€šä¿¡":void 0})}}catch(e){t.push({category:"è®¾å¤‡éªŒè¯",check:"è®¾å¤‡éªŒè¯æ£€æŸ¥",status:"fail",message:`è®¾å¤‡éªŒè¯æ£€æŸ¥å¤±è´¥: ${e.message}`,severity:"high"})}return t}async checkMessageEncryption(){const t=[];return t.push({category:"æ¶ˆæ¯åŠ å¯†",check:"åŠ å¯†æµ‹è¯•",status:"warning",message:"ç¼ºä¹çœŸå®çš„ç«¯åˆ°ç«¯åŠ å¯†æµ‹è¯•",severity:"critical",recommendation:"éœ€è¦å®ç°å®Œæ•´çš„ç«¯åˆ°ç«¯åŠ å¯†æµ‹è¯•ä»¥éªŒè¯æ¶ˆæ¯ç¡®å®è¢«åŠ å¯†ä¸”æœåŠ¡å™¨æ— æ³•è§£å¯†"}),t}async checkSecurityConfiguration(){const t=[];try{const e=(await indexedDB.databases()).filter(n=>n.name&&(n.name.includes("crypto")||n.name.includes("matrix")));t.push({category:"å®‰å…¨é…ç½®",check:"åŠ å¯†æ•°æ®åº“",status:e.length>0?"pass":"warning",message:e.length>0?`å‘ç°${e.length}ä¸ªåŠ å¯†æ•°æ®åº“`:"æœªå‘ç°åŠ å¯†æ•°æ®åº“",severity:"medium"}),e.length>2&&t.push({category:"å®‰å…¨é…ç½®",check:"æ•°æ®åº“å†²çª",status:"warning",message:`å‘ç°${e.length}ä¸ªåŠ å¯†æ•°æ®åº“ï¼Œå¯èƒ½å­˜åœ¨å†²çª`,severity:"medium",recommendation:"å»ºè®®æ¸…ç†å¤šä½™çš„åŠ å¯†æ•°æ®åº“ä»¥é¿å…å†²çª"})}catch(a){t.push({category:"å®‰å…¨é…ç½®",check:"å­˜å‚¨é…ç½®æ£€æŸ¥",status:"fail",message:`å­˜å‚¨é…ç½®æ£€æŸ¥å¤±è´¥: ${a.message}`,severity:"medium"})}return t}generateReportSummary(t){const{overallStatus:a,criticalIssues:e,highIssues:n,mediumIssues:o,lowIssues:y}=t;let c=`ğŸ” E2EEå®‰å…¨æ£€æŸ¥æŠ¥å‘Š
`;c+=`ğŸ“… æ£€æŸ¥æ—¶é—´: ${new Date(t.timestamp).toLocaleString()}
`,c+=`ğŸ“Š æ€»ä½“çŠ¶æ€: ${this.getStatusEmoji(a)} ${a.toUpperCase()}

`,c+=`ğŸ“ˆ é—®é¢˜ç»Ÿè®¡:
`,c+=`ğŸ”´ ä¸¥é‡é—®é¢˜: ${e}
`,c+=`ğŸŸ  é«˜é£é™©é—®é¢˜: ${n}
`,c+=`ğŸŸ¡ ä¸­é£é™©é—®é¢˜: ${o}
`,c+=`ğŸŸ¢ ä½é£é™©é—®é¢˜: ${y}

`,e>0&&(c+=`âš ï¸ å‘ç°ä¸¥é‡å®‰å…¨é—®é¢˜ï¼Œå»ºè®®ç«‹å³ä¿®å¤ï¼

`);const l=t.results.filter(p=>p.severity==="critical"&&p.status==="fail");return l.length>0&&(c+=`ğŸš¨ ä¸¥é‡é—®é¢˜è¯¦æƒ…:
`,l.forEach(p=>{c+=`â€¢ ${p.category} - ${p.check}: ${p.message}
`,p.recommendation&&(c+=`  å»ºè®®: ${p.recommendation}
`)})),c}getStatusEmoji(t){switch(t){case"secure":return"âœ…";case"vulnerable":return"âš ï¸";case"critical":return"ğŸš¨";default:return"â“"}}}const X={class:"security-audit-page"},Y={class:"audit-controls"},Z={key:0,class:"overall-status"},ee={class:"card-header"},te={class:"status-stats"},se={class:"stat-item critical"},ae={class:"stat-number"},ie={class:"stat-item high"},re={class:"stat-number"},ne={class:"stat-item medium"},ce={class:"stat-number"},oe={class:"stat-item low"},le={class:"stat-number"},ue={key:0,class:"critical-warning"},de={key:1,class:"audit-results"},he={class:"card-header"},me={class:"timestamp"},ge={class:"results-by-category"},ve={class:"category-title"},ye={class:"category-results"},pe={class:"result-header"},fe={class:"result-info"},_e={class:"result-icon"},we={class:"result-check"},ke={class:"result-message"},Ie={key:0,class:"result-recommendation"},be={key:2,class:"fix-recommendations"},Se={class:"recommendations-content"},Ee={key:0,class:"critical-fixes"},xe={key:1,class:"high-fixes"},De={key:3,class:"empty-state"},Ce=K({__name:"SecurityAuditPage",setup(M){const t=L(),a=A(!1),e=A(null),n=B(()=>e.value?[...new Set(e.value.results.map(i=>i.category))].sort():[]),o=B(()=>e.value?e.value.criticalIssues>0||e.value.highIssues>0||e.value.mediumIssues>0:!1),y=async()=>{a.value=!0;try{k.info("å¼€å§‹E2EEå®‰å…¨æ£€æŸ¥...");const i=await new Q(t.matrixClient).performSecurityAudit();e.value=i,i.overallStatus==="critical"?k.error(`å‘ç°${i.criticalIssues}ä¸ªä¸¥é‡å®‰å…¨é—®é¢˜ï¼`):i.overallStatus==="vulnerable"?k.warning(`å‘ç°${i.highIssues}ä¸ªé«˜é£é™©é—®é¢˜`):k.success("å®‰å…¨æ£€æŸ¥å®Œæˆï¼Œæœªå‘ç°ä¸¥é‡é—®é¢˜")}catch(r){console.error("å®‰å…¨æ£€æŸ¥å¤±è´¥:",r),k.error(`å®‰å…¨æ£€æŸ¥å¤±è´¥: ${r.message}`)}finally{a.value=!1}},c=r=>e.value?e.value.results.filter(i=>i.category===r):[],l=()=>e.value?e.value.results.filter(r=>r.severity==="critical"&&r.status==="fail"):[],p=()=>e.value?e.value.results.filter(r=>r.severity==="high"&&r.status==="fail"):[],T=async()=>{if(e.value)try{const r={...e.value,exportTime:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href},i=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),I=URL.createObjectURL(i),w=document.createElement("a");w.href=I,w.download=`e2ee-security-report-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(I),k.success("æŠ¥å‘Šå·²å¯¼å‡º")}catch{k.error("å¯¼å‡ºæŠ¥å‘Šå¤±è´¥")}},R=r=>new Date(r).toLocaleString("zh-CN"),P=r=>{switch(r){case"secure":return"âœ…";case"vulnerable":return"âš ï¸";case"critical":return"ğŸš¨";default:return"â“"}},U=r=>{switch(r){case"secure":return"success";case"vulnerable":return"warning";case"critical":return"danger";default:return"info"}},W=r=>{switch(r){case"pass":return"âœ…";case"fail":return"âŒ";case"warning":return"âš ï¸";case"unknown":return"â“";default:return"â“"}},z=r=>{switch(r){case"critical":return"danger";case"high":return"danger";case"medium":return"warning";case"low":return"success";default:return"info"}};return V(()=>{}),(r,i)=>{const I=b("el-icon"),w=b("el-button"),$=b("el-tag"),j=b("el-alert"),D=b("el-card"),H=b("el-empty");return d(),h("div",X,[i[11]||(i[11]=s("div",{class:"page-header"},[s("h1",null,"ğŸ” E2EE å®‰å…¨å®¡è®¡"),s("p",{class:"subtitle"},"æ£€æŸ¥ç«¯åˆ°ç«¯åŠ å¯†å®ç°çš„å®‰å…¨æ€§")],-1)),s("div",Y,[m(w,{type:"primary",onClick:y,loading:a.value,size:"large"},{default:g(()=>[m(I,null,{default:g(()=>[m(C(O))]),_:1}),S(" "+u(a.value?"æ£€æŸ¥ä¸­...":"å¼€å§‹å®‰å…¨æ£€æŸ¥"),1)]),_:1},8,["loading"]),e.value?(d(),N(w,{key:0,onClick:T,size:"large"},{default:g(()=>[m(I,null,{default:g(()=>[m(C(F))]),_:1}),i[0]||(i[0]=S(" å¯¼å‡ºæŠ¥å‘Š "))]),_:1,__:[0]})):_("",!0)]),e.value?(d(),h("div",Z,[m(D,null,{header:g(()=>[s("div",ee,[i[1]||(i[1]=s("span",null,"æ€»ä½“å®‰å…¨çŠ¶æ€",-1)),m($,{type:U(e.value.overallStatus),size:"large"},{default:g(()=>[S(u(P(e.value.overallStatus))+" "+u(e.value.overallStatus.toUpperCase()),1)]),_:1},8,["type"])])]),default:g(()=>[s("div",te,[s("div",se,[s("div",ae,u(e.value.criticalIssues),1),i[2]||(i[2]=s("div",{class:"stat-label"},"ä¸¥é‡é—®é¢˜",-1))]),s("div",ie,[s("div",re,u(e.value.highIssues),1),i[3]||(i[3]=s("div",{class:"stat-label"},"é«˜é£é™©",-1))]),s("div",ne,[s("div",ce,u(e.value.mediumIssues),1),i[4]||(i[4]=s("div",{class:"stat-label"},"ä¸­é£é™©",-1))]),s("div",oe,[s("div",le,u(e.value.lowIssues),1),i[5]||(i[5]=s("div",{class:"stat-label"},"ä½é£é™©",-1))])]),e.value.criticalIssues>0?(d(),h("div",ue,[m(j,{title:"å‘ç°ä¸¥é‡å®‰å…¨é—®é¢˜ï¼",type:"error",description:"å»ºè®®ç«‹å³åœæ­¢ä½¿ç”¨E2EEåŠŸèƒ½ï¼Œç›´åˆ°ä¿®å¤è¿™äº›é—®é¢˜ã€‚","show-icon":"",closable:!1})])):_("",!0)]),_:1})])):_("",!0),e.value?(d(),h("div",de,[m(D,null,{header:g(()=>[s("div",he,[i[6]||(i[6]=s("span",null,"æ£€æŸ¥ç»“æœè¯¦æƒ…",-1)),s("span",me," æ£€æŸ¥æ—¶é—´: "+u(R(e.value.timestamp)),1)])]),default:g(()=>[s("div",ge,[(d(!0),h(E,null,x(n.value,v=>(d(),h("div",{key:v,class:"category-section"},[s("h3",ve,u(v),1),s("div",ye,[(d(!0),h(E,null,x(c(v),f=>(d(),h("div",{key:f.check,class:q(["result-item",[f.status,f.severity]])},[s("div",pe,[s("div",fe,[s("span",_e,u(W(f.status)),1),s("span",we,u(f.check),1),m($,{type:z(f.severity),size:"small"},{default:g(()=>[S(u(f.severity),1)]),_:2},1032,["type"])])]),s("div",ke,u(f.message),1),f.recommendation?(d(),h("div",Ie,[m(I,null,{default:g(()=>[m(C(J))]),_:1}),s("span",null,"å»ºè®®: "+u(f.recommendation),1)])):_("",!0)],2))),128))])]))),128))])]),_:1})])):_("",!0),e.value&&o.value?(d(),h("div",be,[m(D,null,{header:g(()=>i[7]||(i[7]=[s("div",{class:"card-header"},[s("span",null,"ğŸ”§ ä¿®å¤å»ºè®®")],-1)])),default:g(()=>[s("div",Se,[e.value.criticalIssues>0?(d(),h("div",Ee,[i[8]||(i[8]=s("h4",null,"ğŸš¨ ç´§æ€¥ä¿®å¤ï¼ˆä¸¥é‡é—®é¢˜ï¼‰",-1)),s("ul",null,[(d(!0),h(E,null,x(l(),v=>(d(),h("li",{key:v.check},[s("strong",null,u(v.check),1),S(": "+u(v.recommendation||"éœ€è¦ç«‹å³ä¿®å¤"),1)]))),128))])])):_("",!0),e.value.highIssues>0?(d(),h("div",xe,[i[9]||(i[9]=s("h4",null,"âš ï¸ é«˜ä¼˜å…ˆçº§ä¿®å¤",-1)),s("ul",null,[(d(!0),h(E,null,x(p(),v=>(d(),h("li",{key:v.check},[s("strong",null,u(v.check),1),S(": "+u(v.recommendation||"å»ºè®®å°½å¿«ä¿®å¤"),1)]))),128))])])):_("",!0),i[10]||(i[10]=s("div",{class:"general-recommendations"},[s("h4",null,"ğŸ“‹ é€šç”¨å»ºè®®"),s("ul",null,[s("li",null,"å®šæœŸè¿è¡Œå®‰å…¨æ£€æŸ¥ä»¥ç›‘æ§E2EEçŠ¶æ€"),s("li",null,"ç¡®ä¿æ‰€æœ‰è®¾å¤‡éƒ½ç»è¿‡éªŒè¯"),s("li",null,"å¯ç”¨å¯†é’¥å¤‡ä»½ä»¥é˜²è®¾å¤‡ä¸¢å¤±"),s("li",null,"ä½¿ç”¨HTTPSè¿æ¥ä»¥ç¡®ä¿ä¼ è¾“å®‰å…¨"),s("li",null,"ä¿æŒMatrix SDKå’Œä¾èµ–åº“çš„æœ€æ–°ç‰ˆæœ¬")])],-1))])]),_:1})])):_("",!0),!e.value&&!a.value?(d(),h("div",De,[m(H,{description:"ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹å®‰å…¨æ£€æŸ¥"})])):_("",!0)])}}}),Ae=G(Ce,[["__scopeId","data-v-2ab8a369"]]);export{Ae as default};
