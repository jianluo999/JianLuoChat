import{j as X,f as Y,g as u,h as F,y as ee,A as se,c as i,b as v,a as n,t as d,n as g,F as j,r as E,w as te,v as ne,p as x,U as oe,o as l,_ as ie}from"./index-Cl5nGqgc.js";const le={class:"message-input-container"},ae={key:0,class:"reply-preview"},re={class:"reply-content"},ce={class:"reply-header"},ue={class:"reply-user"},de={class:"reply-message"},pe={class:"input-area"},ve={class:"input-toolbar"},ge={key:0,class:"formatting-toolbar"},me={key:1,class:"emoji-picker"},ye={class:"emoji-categories"},fe=["onClick"],he={class:"emoji-grid"},_e=["onClick"],be={class:"input-wrapper"},ke=["placeholder","disabled"],xe={class:"input-actions"},we=["disabled"],Ce={key:0,viewBox:"0 0 24 24"},Me={key:1,class:"sending-spinner"},Fe={class:"input-status"},je={key:0,class:"typing-indicator"},Ee={class:"typing-users"},Te={class:"message-info"},Ie={key:0,class:"encryption-status"},Be={key:1,class:"file-upload-preview"},ze={class:"file-info"},Se={class:"file-icon"},Ve={class:"file-details"},$e={class:"file-name"},De={class:"file-size"},He={class:"file-status"},Le={key:0,class:"status-failed"},Ue={key:1,class:"status-success"},Ke={key:2,class:"status-uploading"},Ne={key:0,class:"file-progress"},Pe=["onClick"],Re=X({__name:"MatrixMessageInput",props:{roomId:{},placeholder:{},disabled:{type:Boolean},supportsEncryption:{type:Boolean},replyingTo:{}},emits:["send-message","cancel-reply","typing-start","typing-stop"],setup(H,{emit:L}){const T=Y(),y=H,k=L,r=u(""),f=u(!1),m=u(!1),h=u(!1),_=u(!1),w=u("smileys"),p=u([]),I=u([]),c=u(),B=u([{name:"smileys",icon:"üòä",emojis:["üòä","üòÇ","ü•∞","üòç","ü§î","üòÖ","üòé","üôÑ","üò¥","ü§ó"]},{name:"gestures",icon:"üëç",emojis:["üëç","üëé","üëå","‚úåÔ∏è","ü§û","üëè","üôå","ü§ù","üí™","üôè"]},{name:"objects",icon:"üéâ",emojis:["üéâ","üéä","üî•","üíØ","‚≠ê","‚ù§Ô∏è","üíî","üí°","üöÄ","üéØ"]}]),U=F(()=>B.value.find(e=>e.name===w.value)?.emojis||[]),z=F(()=>r.value.trim().length>0&&!f.value&&!y.disabled),K=F(()=>I.value.length>0),N=t=>{t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),S()):t.key==="Escape"&&y.replyingTo&&C()},P=()=>{x(()=>{c.value&&(c.value.style.height="auto",c.value.style.height=c.value.scrollHeight+"px")}),k("typing-start")},R=t=>{const e=t.clipboardData?.items;if(e)for(let s=0;s<e.length;s++){const o=e[s];if(o.type.indexOf("image")!==-1){const a=o.getAsFile();a&&V(a)}}},S=async()=>{if(!z.value)return;const t=r.value.trim();f.value=!0;try{const e={encrypted:_.value,replyTo:y.replyingTo?.id};k("send-message",t,e),r.value="",y.replyingTo&&C(),x(()=>{c.value&&(c.value.style.height="auto")})}catch(e){console.error("Failed to send message:",e)}finally{f.value=!1}},C=()=>{k("cancel-reply")},W=()=>{m.value=!m.value,h.value=!1},A=()=>{h.value=!h.value,m.value=!1},O=()=>{_.value=!_.value},Z=t=>{const e=c.value;if(e){const s=e.selectionStart,o=e.selectionEnd,a=r.value;r.value=a.substring(0,s)+t+a.substring(o),x(()=>{e.focus(),e.setSelectionRange(s+t.length,s+t.length)})}m.value=!1},b=(t,e)=>{const s=c.value;if(s){const o=s.selectionStart,a=s.selectionEnd,M=r.value,$=M.substring(o,a);r.value=M.substring(0,o)+t+$+e+M.substring(a),x(()=>{s.focus();const D=o+t.length+$.length+e.length;s.setSelectionRange(D,D)})}},G=()=>{const t=document.createElement("input");t.type="file",t.multiple=!0,t.accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt",t.onchange=e=>{const s=e.target.files;for(let o=0;o<s.length;o++)V(s[o])},t.click()},V=async t=>{const e={id:Date.now()+Math.random(),name:t.name,size:t.size,progress:0,file:t};p.value.push(e);try{e.progress=10;const s=await T.uploadFileToMatrix(t);e.progress=80,s&&(await T.sendFileMessage(y.roomId,t,s),e.progress=100,setTimeout(()=>{const o=p.value.findIndex(a=>a.id===e.id);o>-1&&p.value.splice(o,1)},1e3),console.log(`‚úÖ Êñá‰ª∂ ${t.name} ‰∏ä‰º†Âπ∂ÂèëÈÄÅÊàêÂäü`))}catch(s){console.error("‚ùå Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•:",s),e.progress=-1,setTimeout(()=>{const o=p.value.findIndex(a=>a.id===e.id);o>-1&&p.value.splice(o,1)},3e3)}},q=t=>{const e=p.value.findIndex(s=>s.id===t);e!==-1&&p.value.splice(e,1)},J=t=>{if(t===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,o)).toFixed(2))+" "+s[o]},Q=t=>{const e=t.file.type;return e.startsWith("image/")?"üñºÔ∏è":e.startsWith("video/")?"üé•":e.startsWith("audio/")?"üéµ":e.includes("pdf")?"üìÑ":e.includes("word")||e.includes("doc")?"üìù":e.includes("excel")||e.includes("sheet")?"üìä":e.includes("powerpoint")||e.includes("presentation")?"üìΩÔ∏è":e.includes("zip")||e.includes("rar")||e.includes("7z")?"üì¶":"üìÑ"};return ee(()=>{c.value&&c.value.focus()}),se(()=>{k("typing-stop")}),(t,e)=>(l(),i("div",le,[t.replyingTo?(l(),i("div",ae,[n("div",re,[n("div",ce,[e[6]||(e[6]=n("span",{class:"reply-icon"},"‚Ü≥",-1)),n("span",ue,d(t.replyingTo.senderName),1)]),n("div",de,d(t.replyingTo.content),1)]),n("button",{onClick:C,class:"cancel-reply"},"√ó")])):v("",!0),n("div",pe,[n("div",ve,[n("button",{onClick:W,class:g(["toolbar-btn",{active:m.value}]),title:"Ë°®ÊÉÖÁ¨¶Âè∑"}," üòä ",2),n("button",{onClick:G,class:"toolbar-btn",title:"ÈôÑ‰ª∂"}," üìé "),n("button",{onClick:A,class:g(["toolbar-btn",{active:h.value}]),title:"Ê†ºÂºèÂåñ"},e[7]||(e[7]=[n("svg",{viewBox:"0 0 24 24"},[n("path",{d:"M5,4V7H10.5V19H13.5V7H19V4H5Z"})],-1)]),2),t.supportsEncryption?(l(),i("button",{key:0,onClick:O,class:g(["toolbar-btn encryption-btn",{active:_.value}]),title:"Á´ØÂà∞Á´ØÂä†ÂØÜ"}," üîê ",2)):v("",!0)]),h.value?(l(),i("div",ge,[n("button",{onClick:e[0]||(e[0]=s=>b("**","**")),class:"format-btn",title:"Á≤ó‰Ωì"},e[8]||(e[8]=[n("strong",null,"B",-1)])),n("button",{onClick:e[1]||(e[1]=s=>b("*","*")),class:"format-btn",title:"Êñú‰Ωì"},e[9]||(e[9]=[n("em",null,"I",-1)])),n("button",{onClick:e[2]||(e[2]=s=>b("`","`")),class:"format-btn",title:"‰ª£Á†Å"},e[10]||(e[10]=[n("code",null,"</>",-1)])),n("button",{onClick:e[3]||(e[3]=s=>b("```\n","\n```")),class:"format-btn",title:"‰ª£Á†ÅÂùó"}," { } "),n("button",{onClick:e[4]||(e[4]=s=>b("> ","")),class:"format-btn",title:"ÂºïÁî®"},' " ')])):v("",!0),m.value?(l(),i("div",me,[n("div",ye,[(l(!0),i(j,null,E(B.value,s=>(l(),i("button",{key:s.name,onClick:o=>w.value=s.name,class:g(["emoji-category-btn",{active:w.value===s.name}])},d(s.icon),11,fe))),128))]),n("div",he,[(l(!0),i(j,null,E(U.value,s=>(l(),i("button",{key:s,onClick:o=>Z(s),class:"emoji-btn"},d(s),9,_e))),128))])])):v("",!0),n("div",be,[te(n("textarea",{ref_key:"messageInput",ref:c,"onUpdate:modelValue":e[5]||(e[5]=s=>r.value=s),onKeydown:N,onInput:P,onPaste:R,placeholder:t.placeholder,class:"message-textarea",disabled:t.disabled,rows:"1"},null,40,ke),[[ne,r.value]]),n("div",xe,[n("button",{onClick:S,disabled:!z.value,class:g(["send-button",{sending:f.value}])},[f.value?(l(),i("div",Me)):(l(),i("svg",Ce,e[11]||(e[11]=[n("path",{d:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},null,-1)])))],10,we)])]),n("div",Fe,[K.value?(l(),i("div",je,[n("span",Ee,d(I.value.join(", ")),1),e[12]||(e[12]=n("span",{class:"typing-text"},"Ê≠£Âú®ËæìÂÖ•...",-1))])):v("",!0),n("div",Te,[_.value?(l(),i("span",Ie,"üîê Âä†ÂØÜ")):v("",!0),n("span",{class:g(["char-count",{warning:r.value.length>4e3}])},d(r.value.length)+"/5000 ",3)])])]),p.value.length>0?(l(),i("div",Be,[(l(!0),i(j,null,E(p.value,s=>(l(),i("div",{key:s.id,class:g(["file-preview",{"upload-failed":s.progress===-1,"upload-complete":s.progress===100}])},[n("div",ze,[n("div",Se,d(Q(s)),1),n("div",Ve,[n("div",$e,d(s.name),1),n("div",De,d(J(s.size)),1),n("div",He,[s.progress===-1?(l(),i("span",Le,"‚ùå ‰∏ä‰º†Â§±Ë¥•")):s.progress===100?(l(),i("span",Ue,"‚úÖ ‰∏ä‰º†ÊàêÂäü")):(l(),i("span",Ke,"üì§ ‰∏ä‰º†‰∏≠... "+d(s.progress)+"%",1))])])]),s.progress>=0&&s.progress<100?(l(),i("div",Ne,[n("div",{class:"progress-bar",style:oe({width:s.progress+"%"})},null,4)])):v("",!0),n("button",{onClick:o=>q(s.id),class:"remove-file"},"√ó",8,Pe)],2))),128))])):v("",!0)]))}}),Ae=ie(Re,[["__scopeId","data-v-173e2a4d"]]);export{Ae as M};
