import{j as te,f as oe,g as y,h as N,k as fe,c as u,b as w,a as e,l as ce,m as de,t as m,F as K,r as q,n as U,p as J,o as d,_ as se,e as z,w as V,v as H,d as ee,q as ue,s as he,x as Te,y as De,i as ze,z as re,A as Ve,B as D,C as Ee}from"./index-Cl5nGqgc.js";import{M as He}from"./MatrixMessageInput-DhpyKYJ-.js";import{E as ye}from"./EncryptionIndicator-DOmuLn2f.js";const Ue={class:"matrix-message-area"},Ne={key:0,class:"matrix-room-header"},Ae={class:"room-info"},Be={class:"room-title"},je={class:"room-name"},Fe={class:"room-id"},Pe={key:0,class:"no-room-selected"},We={key:1,class:"loading-messages"},Ge={key:2,class:"messages-list"},Oe={key:0,class:"empty-messages"},Je={class:"empty-icon"},Ke={class:"empty-text"},qe={class:"empty-title"},Ye={class:"empty-desc"},Ze={key:0,class:"message-avatar"},Qe={class:"avatar-placeholder"},Xe={class:"message-main"},et={key:0,class:"message-header"},tt={class:"sender-name"},ot={class:"message-timestamp"},st={class:"message-content"},nt={key:0,class:"system-message-content"},it={class:"system-text"},lt={key:1,class:"regular-message-content"},at={class:"message-bubble"},rt={key:0,class:"file-message"},ct={key:0,class:"image-preview"},dt=["src","alt","onClick"],ut={class:"file-info"},mt={class:"file-icon"},vt={class:"file-details"},gt={class:"file-name"},pt={class:"file-size"},ft={class:"file-actions"},ht=["onClick"],yt=["innerHTML"],Ct={key:2,class:"message-text"},xt={class:"message-meta"},bt={class:"message-time"},_t={key:2,class:"no-send-permission"},$t=te({__name:"MatrixMessageAreaSimple",props:{roomId:{}},setup(Y){const s=Y,b=oe(),_=y(),k=y(!1),v=N(()=>s.roomId?b.rooms.find(n=>n.id===s.roomId):null),R=N(()=>s.roomId?(b.messageUpdateTrigger,b.messages.get(s.roomId)||[]):[]),$=n=>n.sender===b.currentUser?.id,M=n=>n.type!=="m.room.message",C=n=>n?n.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2):"?",c=n=>n.senderName||n.sender.split(":")[0].substring(1),x=n=>{const a=new Date(n),S=new Date().getTime()-a.getTime();return S<6e4?"刚刚":S<36e5?`${Math.floor(S/6e4)}分钟前`:S<864e5?a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):a.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},I=n=>n?n.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/<iframe[^>]*>.*?<\/iframe>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,""):"",E=()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)},T=async()=>{if(!(!v.value||k.value))try{const n=_.value;if(!n)return;if(n.scrollHeight<=n.clientHeight){console.log("内容未填满，暂不加载更多");return}k.value=!0,console.log("📚 加载更多历史消息...");const a=n.scrollHeight,r=n.scrollTop;await b.loadMoreHistoryMessages(v.value.id),J(()=>{if(n){const X=n.scrollHeight-a;n.scrollTop=r+X}})}catch(n){console.error("加载历史消息失败:",n)}finally{k.value=!1}};let p=null,l=!1;const g=n=>{const a=n.target;!a||k.value||l||p||(p=window.setTimeout(async()=>{p=null,a.scrollTop<50&&(l=!0,await T(),l=!1)},500))},A=async n=>{if(!(!n.trim()||!v.value))try{await b.sendMatrixMessage(v.value.id,n),J(()=>{E()})}catch(a){console.error("Failed to send message:",a);const r=a.message||"发送消息失败";r.includes("加密")?alert(`⚠️ 加密房间暂不支持

`+r):alert("❌ 发送失败: "+r)}},B=()=>{if(!v.value)return"💬";const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a&&!a.maySendMessage())return"🔒"}return"💬"},ne=()=>{if(!v.value)return"还没有消息";const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a&&!a.maySendMessage())return"只读房间"}return"还没有消息"},j=()=>{if(!v.value)return"成为第一个在这个房间发言的人吧！";const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a&&!a.maySendMessage())return"您在此房间只有查看权限，无法发送消息"}return"成为第一个在这个房间发言的人吧！"},P=N(()=>{if(!v.value)return!1;const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a)return a.maySendMessage()}return!0}),F=()=>0,ie=()=>1,le=()=>{if(v.value?.encrypted)return"m.megolm.v1.aes-sha2"},Z=n=>{if(n===0)return"0 Bytes";const a=1024,r=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(n)/Math.log(a));return parseFloat((n/Math.pow(a,S)).toFixed(2))+" "+r[S]},Q=n=>n.startsWith("image/")?"🖼️":n.startsWith("video/")?"🎥":n.startsWith("audio/")?"🎵":n.includes("pdf")?"📄":n.includes("word")||n.includes("doc")?"📝":n.includes("excel")||n.includes("sheet")?"📊":n.includes("powerpoint")||n.includes("presentation")?"📽️":n.includes("zip")||n.includes("rar")||n.includes("7z")?"📦":"📎",ae=n=>{const a=document.createElement("div");a.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    cursor: pointer;
  `;const r=document.createElement("img");r.src=n.url,r.style.cssText=`
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
  `,a.appendChild(r),document.body.appendChild(a),a.onclick=()=>{document.body.removeChild(a)}},W=n=>{const a=document.createElement("a");a.href=n.url,a.download=n.name,document.body.appendChild(a),a.click(),document.body.removeChild(a)};return fe(()=>s.roomId,async(n,a)=>{if(n&&n!==a){console.log(`🔄 房间切换: ${a} -> ${n}`);try{k.value=!0,await b.fetchMatrixMessages(n),b.markRoomAsRead(n),J(()=>{E()})}catch(r){console.error("Failed to load room messages:",r)}finally{k.value=!1}}},{immediate:!0}),fe(()=>R.value,(n,a)=>{J(()=>{const r=_.value;if(!r)return;r.scrollHeight-r.scrollTop-r.clientHeight<100&&n&&a&&n.length>a.length&&E()})},{deep:!0}),(n,a)=>(d(),u("div",Ue,[v.value?(d(),u("div",Ne,[e("div",Ae,[e("div",Be,[e("div",je,m(v.value.name),1),e("div",Fe,m(v.value.id),1)]),de(ye,{type:"room",encrypted:v.value.encrypted,"member-count":v.value.memberCount,"verified-devices":F(),"total-devices":ie(),algorithm:le()},null,8,["encrypted","member-count","verified-devices","total-devices","algorithm"])])])):w("",!0),e("div",{class:"matrix-messages-container",ref_key:"messagesContainer",ref:_,onScroll:g},[v.value?k.value?(d(),u("div",We,a[1]||(a[1]=[e("div",{class:"loading-spinner"},"⏳",-1),e("div",{class:"loading-text"},"加载消息中...",-1)]))):(d(),u("div",Ge,[R.value.length===0?(d(),u("div",Oe,[e("div",Je,m(B()),1),e("div",Ke,[e("div",qe,m(ne()),1),e("div",Ye,m(j()),1)])])):w("",!0),(d(!0),u(K,null,q(R.value,r=>(d(),u("div",{key:r.id,class:U(["message-item",{"own-message":$(r),"system-message":M(r)}])},[!$(r)&&!M(r)?(d(),u("div",Ze,[e("div",Qe,m(C(r.sender)),1)])):w("",!0),e("div",Xe,[!$(r)&&!M(r)?(d(),u("div",et,[e("span",tt,m(c(r)),1),e("span",ot,m(x(r.timestamp)),1)])):w("",!0),e("div",st,[M(r)?(d(),u("div",nt,[a[2]||(a[2]=e("span",{class:"system-icon"},"ℹ️",-1)),e("span",it,m(r.content),1)])):(d(),u("div",lt,[e("div",at,[r.fileInfo?(d(),u("div",rt,[r.fileInfo.isImage&&r.fileInfo.url?(d(),u("div",ct,[e("img",{src:r.fileInfo.url,alt:r.fileInfo.name,onClick:S=>ae(r.fileInfo)},null,8,dt)])):w("",!0),e("div",ut,[e("div",mt,m(r.fileInfo.isImage?"🖼️":Q(r.fileInfo.type)),1),e("div",vt,[e("div",gt,m(r.fileInfo.name),1),e("div",pt,m(Z(r.fileInfo.size)),1)]),e("div",ft,[e("button",{onClick:S=>W(r.fileInfo),class:"download-btn"}," 📥 ",8,ht)])])])):r.formattedContent&&r.format==="org.matrix.custom.html"?(d(),u("div",{key:1,class:"message-text formatted-message",innerHTML:I(r.formattedContent)},null,8,yt)):(d(),u("div",Ct,m(r.content),1))]),e("div",xt,[e("span",bt,m(x(r.timestamp)),1),de(ye,{type:"message",encrypted:r.encrypted,decrypted:!r.decryptionError,"decryption-error":r.decryptionError},null,8,["encrypted","decrypted","decryption-error"])])]))])])],2))),128))])):(d(),u("div",Pe,a[0]||(a[0]=[e("div",{class:"welcome-content"},[e("div",{class:"welcome-message"},[e("h2",null,"欢迎使用Matrix"),e("p",null,"选择一个房间开始聊天")])],-1)])))],544),v.value&&P.value?(d(),ce(He,{key:1,"room-id":v.value.id,placeholder:`发送消息到 ${v.value.name}...`,onSendMessage:A},null,8,["room-id","placeholder"])):v.value&&!P.value?(d(),u("div",_t," 🔒 您在此房间只有查看权限，无法发送消息 ")):w("",!0)]))}}),wt=se($t,[["__scopeId","data-v-2d53faf1"]]),kt={class:"modal-header"},Mt={class:"modal-content"},St={class:"user-input-section"},Rt={key:0,class:"recent-contacts"},It={class:"contacts-list"},Lt=["onClick"],Tt={class:"contact-avatar"},Dt={class:"contact-info"},zt={class:"contact-name"},Vt={class:"contact-id"},Et={class:"server-suggestion"},Ht={class:"server-links"},Ut={class:"server-link"},Nt={class:"server-link"},At={class:"modal-footer"},Bt=["disabled"],jt=te({__name:"StartDirectMessageDialog",emits:["close","start-dm"],setup(Y,{emit:s}){const b=s;oe();const _=y(""),k=N(()=>[{userId:"@alice:matrix.org",displayName:"Alice"},{userId:"@bob:element.io",displayName:"Bob"}]),v=C=>C.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2),R=C=>{_.value=C},$=()=>{if(_.value.trim()){if(!_.value.startsWith("@")||!_.value.includes(":")){alert("请输入有效的用户ID格式：@username:server.com");return}b("start-dm",_.value.trim())}},M=async C=>{try{await navigator.clipboard.writeText(C),console.log("已复制到剪贴板:",C)}catch(c){console.error("复制失败:",c)}};return(C,c)=>(d(),u("div",{class:"modal-overlay",onClick:c[6]||(c[6]=x=>C.$emit("close"))},[e("div",{class:"modal start-dm-modal",onClick:c[5]||(c[5]=ue(()=>{},["stop"]))},[e("div",kt,[c[7]||(c[7]=e("h2",null,"开始私聊",-1)),e("button",{class:"close-btn",onClick:c[0]||(c[0]=x=>C.$emit("close"))},"×")]),e("div",Mt,[c[15]||(c[15]=e("div",{class:"modal-description"},[e("p",null,[z("输入用户ID开始私聊对话。用户ID格式为 "),e("span",{class:"user-id-example"},"@username:server.com")])],-1)),e("div",St,[c[8]||(c[8]=e("label",{for:"userId"},"用户ID",-1)),V(e("input",{id:"userId",type:"text","onUpdate:modelValue":c[1]||(c[1]=x=>_.value=x),placeholder:"@user:matrix.org",class:"user-input",onKeyup:ee($,["enter"])},null,544),[[H,_.value]])]),c[16]||(c[16]=e("div",{class:"dm-tips"},[e("h4",null,"隐私提示"),e("p",null,"• 私聊消息只有你和对方能看到"),e("p",null,"• 对方会收到你的聊天邀请"),e("p",null,"• 对方需要接受邀请才能开始对话")],-1)),k.value.length>0?(d(),u("div",Rt,[c[9]||(c[9]=e("h4",null,"最近联系人",-1)),e("div",It,[(d(!0),u(K,null,q(k.value,x=>(d(),u("div",{key:x.userId,class:"contact-item",onClick:I=>R(x.userId)},[e("div",Tt,m(v(x.displayName||x.userId)),1),e("div",Dt,[e("div",zt,m(x.displayName||x.userId),1),e("div",Vt,m(x.userId),1)])],8,Lt))),128))])])):w("",!0),e("div",Et,[c[14]||(c[14]=e("p",null,"需要帮助找到用户？试试这些Matrix服务器：",-1)),e("div",Ht,[e("div",Ut,[c[11]||(c[11]=e("a",{href:"https://matrix.org",target:"_blank"},"matrix.org",-1)),e("button",{class:"copy-btn",onClick:c[2]||(c[2]=x=>M("matrix.org"))},c[10]||(c[10]=[e("i",{class:"icon-copy"},null,-1)]))]),e("div",Nt,[c[13]||(c[13]=e("a",{href:"https://element.io",target:"_blank"},"element.io",-1)),e("button",{class:"copy-btn",onClick:c[3]||(c[3]=x=>M("element.io"))},c[12]||(c[12]=[e("i",{class:"icon-copy"},null,-1)]))])])])]),e("div",At,[e("button",{class:"btn-secondary",onClick:c[4]||(c[4]=x=>C.$emit("close"))},"取消"),e("button",{class:"btn-primary",onClick:$,disabled:!_.value.trim()}," 开始私聊 ",8,Bt)])])]))}}),Ft=se(jt,[["__scopeId","data-v-62a3f561"]]),Pt={class:"modal-header"},Wt={class:"modal-content"},Gt={class:"form-section"},Ot={class:"form-section"},Jt={class:"form-section"},Kt={class:"checkbox-group"},qt={class:"checkbox-item"},Yt={class:"checkbox-item"},Zt={key:0,class:"form-section"},Qt={class:"alias-input-group"},Xt={class:"alias-suffix"},eo={class:"form-section"},to={class:"invite-section"},oo={class:"invite-input-group"},so=["disabled"],no={key:0,class:"invited-users"},io={class:"user-id"},lo=["onClick"],ao={class:"modal-footer"},ro=["disabled"],co=te({__name:"CreateGroupChatDialog",emits:["close","create-group"],setup(Y,{emit:s}){const b=s,_=oe(),k=y(""),v=y(""),R=y(""),$=y(!1),M=y(!0),C=y(""),c=y([]),x=N(()=>{const p=_.currentUser;return p&&p.username.includes(":")?p.username.split(":")[1]:"matrix.org"}),I=()=>{const p=C.value.trim();if(p){if(!p.startsWith("@")||!p.includes(":")){alert("请输入有效的用户ID格式：@username:server.com");return}c.value.includes(p)||(c.value.push(p),C.value="")}},E=p=>{const l=c.value.indexOf(p);l>-1&&c.value.splice(l,1)},T=()=>{if(!k.value.trim())return;const p={name:k.value.trim(),topic:v.value.trim(),visibility:$.value?"public":"private",room_alias_name:$.value&&R.value?R.value:void 0,initial_state:M.value?[{type:"m.room.encryption",content:{algorithm:"m.megolm.v1.aes-sha2"}}]:[],invite:c.value,preset:$.value?"public_chat":"private_chat"};b("create-group",p)};return(p,l)=>(d(),u("div",{class:"modal-overlay",onClick:l[9]||(l[9]=g=>p.$emit("close"))},[e("div",{class:"modal create-group-modal",onClick:l[8]||(l[8]=ue(()=>{},["stop"]))},[e("div",Pt,[l[10]||(l[10]=e("h2",null,"创建群聊",-1)),e("button",{class:"close-btn",onClick:l[0]||(l[0]=g=>p.$emit("close"))},"×")]),e("div",Wt,[e("div",Gt,[l[11]||(l[11]=e("label",{for:"roomName"},"房间名称 *",-1)),V(e("input",{id:"roomName",type:"text","onUpdate:modelValue":l[1]||(l[1]=g=>k.value=g),placeholder:"输入房间名称",class:"form-input",onKeyup:ee(T,["enter"])},null,544),[[H,k.value]])]),e("div",Ot,[l[12]||(l[12]=e("label",{for:"roomTopic"},"房间描述",-1)),V(e("textarea",{id:"roomTopic","onUpdate:modelValue":l[2]||(l[2]=g=>v.value=g),placeholder:"描述这个房间的用途（可选）",class:"form-textarea",rows:"3"},null,512),[[H,v.value]])]),e("div",Jt,[l[17]||(l[17]=e("label",null,"房间设置",-1)),e("div",Kt,[e("label",qt,[V(e("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=g=>$.value=g)},null,512),[[he,$.value]]),l[13]||(l[13]=e("span",{class:"checkbox-label"},"公开房间",-1)),l[14]||(l[14]=e("span",{class:"checkbox-desc"},"任何人都可以找到并加入",-1))]),e("label",Yt,[V(e("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=g=>M.value=g)},null,512),[[he,M.value]]),l[15]||(l[15]=e("span",{class:"checkbox-label"},"启用端到端加密",-1)),l[16]||(l[16]=e("span",{class:"checkbox-desc"},"保护消息隐私（推荐）",-1))])])]),$.value?(d(),u("div",Zt,[l[19]||(l[19]=e("label",{for:"roomAlias"},"房间地址",-1)),e("div",Qt,[l[18]||(l[18]=e("span",{class:"alias-prefix"},"#",-1)),V(e("input",{id:"roomAlias",type:"text","onUpdate:modelValue":l[5]||(l[5]=g=>R.value=g),placeholder:"room-name",class:"form-input alias-input"},null,512),[[H,R.value]]),e("span",Xt,":"+m(x.value),1)]),l[20]||(l[20]=e("div",{class:"form-hint"}," 房间地址用于其他人找到和加入这个房间 ",-1))])):w("",!0),e("div",eo,[l[21]||(l[21]=e("label",null,"邀请用户",-1)),e("div",to,[e("div",oo,[V(e("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=g=>C.value=g),placeholder:"@user:matrix.org",class:"form-input",onKeyup:ee(I,["enter"])},null,544),[[H,C.value]]),e("button",{class:"btn-secondary",onClick:I,disabled:!C.value.trim()}," 添加 ",8,so)]),c.value.length>0?(d(),u("div",no,[(d(!0),u(K,null,q(c.value,g=>(d(),u("div",{key:g,class:"invited-user"},[e("span",io,m(g),1),e("button",{class:"remove-btn",onClick:A=>E(g)},"×",8,lo)]))),128))])):w("",!0)])]),l[22]||(l[22]=e("div",{class:"creation-tips"},[e("h4",null,"创建提示"),e("p",null,"• 房间创建后，你将成为房间管理员"),e("p",null,"• 你可以随时修改房间设置和邀请更多用户"),e("p",null,"• 公开房间会出现在房间目录中")],-1))]),e("div",ao,[e("button",{class:"btn-secondary",onClick:l[7]||(l[7]=g=>p.$emit("close"))},"取消"),e("button",{class:"btn-primary",onClick:T,disabled:!k.value.trim()}," 创建房间 ",8,ro)])])]))}}),uo=se(co,[["__scopeId","data-v-0ce406e8"]]),mo={class:"wechat-layout"},vo={class:"wechat-sidebar"},go={class:"sidebar-header"},po={class:"user-avatar-nav"},fo={class:"avatar-placeholder-nav"},ho={class:"sidebar-nav"},yo={class:"chat-list-panel"},Co={class:"chat-list-header"},xo={key:0,class:"user-info"},bo={class:"user-avatar"},_o={class:"username"},$o={class:"header-actions"},wo={key:0,class:"more-menu"},ko={class:"search-container"},Mo={class:"search-box"},So={class:"chat-list"},Ro={key:0,class:"loading-chat-list"},Io={key:1,class:"matrix-client-warning"},Lo=["disabled"],To={key:2,class:"empty-chat-list"},Do=["onClick"],zo={class:"chat-avatar"},Vo={class:"chat-content"},Eo={class:"chat-header"},Ho={class:"chat-name"},Uo={key:0,class:"chat-time"},No={class:"chat-preview"},Ao={class:"last-message"},Bo={class:"chat-badges"},jo={key:0,class:"unread-count"},Fo={class:"chat-panel"},Po={key:0,class:"no-chat-selected"},Wo={key:1,class:"active-chat-container"},Go={class:"message-list"},Oo={key:0,class:"explore-panel"},Jo={class:"explore-header"},Ko={class:"explore-content"},qo={class:"search-bar"},Yo={class:"public-rooms-list"},Zo={key:0,class:"loading-state"},Qo={key:1},Xo={class:"room-avatar"},es={class:"room-info"},ts={class:"room-name"},os={class:"room-topic"},ss={class:"room-members"},ns={class:"room-actions"},is=["onClick"],ls={key:2,class:"empty-state"},as={class:"modal-body"},rs={class:"input-group"},cs={class:"modal-footer"},ds=["disabled"],us=te({__name:"WeChatStyleLayout",setup(Y){const s=oe(),b=ze(),{handleError:_,handleMatrixError:k,handlePerformanceError:v}=Te(),R=y(""),$=y("chat"),M=y(""),C=y(""),c=y(!1),x=y(!1),I=y(!1),E=y(!1),T=y(""),p=y(!1),l=y(!1),g=y([]),A=y(!1),B=y(!1),ne=y(),j=N(()=>{const o=s.rooms||[];return M.value?o.filter(t=>t.name.toLowerCase().includes(M.value.toLowerCase())):o}),P=N(()=>C.value?g.value.filter(o=>(o.name||"").toLowerCase().includes(C.value.toLowerCase())||(o.topic||"").toLowerCase().includes(C.value.toLowerCase())):g.value),F=o=>{$.value=o,console.log("切换到导航:",o)},ie=()=>{B.value=!B.value},le=()=>{console.log("退出按钮被点击了");try{console.log("开始清除Matrix状态..."),s.logout(),console.log("Matrix状态已清除"),console.log("准备跳转到登录页面..."),b.push("/login"),console.log("路由跳转命令已发送")}catch(o){console.error("退出过程中发生错误:",o),window.location.href="/login"}},Z=o=>o.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),Q=o=>o.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),ae=o=>{const t=new Date(o);return new Date().getTime()-t.getTime()<24*60*60*1e3?t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},W=async o=>{if(R.value=o,s.setCurrentRoom(o),s.matrixClient&&!s.matrixClient.getRoom(o)){console.log(`🔄 房间 ${o} 不存在，尝试刷新房间列表...`);try{await s.fetchMatrixRooms(),console.log("✅ 房间列表刷新完成")}catch(i){console.warn("房间列表刷新失败:",i)}}try{console.log(`🔄 选择房间: ${o}，开始加载消息...`),await s.fetchMatrixMessages(o),console.log(`✅ 房间 ${o} 消息加载完成`)}catch(t){console.error("Failed to load room messages:",t)}},n=()=>{c.value=!0},a=()=>{x.value=!0},r=()=>{E.value=!0,T.value=""},S=()=>{E.value=!1,T.value="",p.value=!1},X=async()=>{const o=T.value.trim();if(o){if(!s.matrixClient){alert("Matrix客户端未初始化，无法加入房间");return}p.value=!0;try{console.log(`🏠 尝试加入房间: ${o}`),await s.matrixClient.joinRoom(o),console.log(`✅ 成功加入房间: ${o}`),await s.fetchMatrixRooms(),S(),alert(`✅ 成功加入房间: ${o}`)}catch(t){console.error("❌ 加入房间失败:",t),alert(`❌ 加入房间失败: ${t.message||"未知错误"}`)}finally{p.value=!1}}},Ce=async()=>{if(console.log("🔧 强制创建文件传输助手..."),!s.matrixClient){console.error("❌ Matrix客户端未初始化"),alert("Matrix客户端未初始化，无法创建文件传输助手");return}try{s.loading=!0;const o=s.ensureFileTransferRoom();console.log("✅ 文件传输助手创建完成:",o),await s.fetchMatrixRooms(),alert("文件传输助手创建成功！")}catch(o){console.error("❌ 创建文件传输助手失败:",o),alert("创建文件传输助手失败: "+(o?.message||"未知错误"))}finally{s.loading=!1}},me=async()=>{if(console.log("🔄 手动刷新房间列表..."),!s.matrixClient){console.error("❌ Matrix客户端未初始化"),k({message:"Matrix客户端未初始化，无法刷新房间",operation:"sync",isRecoverable:!0});return}try{if(s.loading=!0,console.log("🚀 尝试直接获取房间列表..."),await s.fetchMatrixRooms(),s.rooms.length>0){console.log(`✅ 直接获取成功，找到 ${s.rooms.length} 个房间`);return}const o=s.matrixClient.getSyncState();console.log(`📡 当前同步状态: ${o}`),(o==="STOPPED"||o==="ERROR"||o===null)&&(console.log("🚀 同步状态不佳，重新启动Matrix客户端..."),s.matrixClient.clientRunning&&(s.matrixClient.stopClient(),await new Promise(t=>setTimeout(t,1e3))),await s.matrixClient.startClient({initialSyncLimit:100,lazyLoadMembers:!0}),console.log("⏳ 等待同步完成..."),await new Promise(t=>{let i=!1;const f=setTimeout(()=>{i||(i=!0,s.matrixClient?.removeListener("sync",L),console.warn("同步等待超时，继续刷新房间列表"),t(!0))},8e3),L=O=>{console.log(`🔄 同步状态变化: ${O}`),(O==="PREPARED"||O==="SYNCING")&&!i&&(i=!0,clearTimeout(f),s.matrixClient?.removeListener("sync",L),console.log("✅ 同步状态已改善"),t(!0))};s.matrixClient?.on("sync",L)})),await s.fetchMatrixRooms(),console.log(`✅ 房间列表刷新完成，当前房间数量: ${s.rooms.length}`),s.rooms.length===0?(console.warn("⚠️ 仍然没有找到房间，可能需要："),console.warn("1. 加入一些房间"),console.warn("2. 检查网络连接"),console.warn("3. 重新登录"),alert(`没有找到房间。请尝试：
1. 加入一些公共房间
2. 检查网络连接
3. 重新登录`)):console.log(`✅ 成功刷新房间列表，找到 ${s.rooms.length} 个房间`)}catch(o){console.error("❌ 刷新房间列表失败:",o),alert("刷新房间列表失败: "+(o?.message||"未知错误"))}finally{s.loading=!1}},xe=async()=>{console.log("🐛 Matrix客户端调试信息:");try{const o=await s.generateDebugReport();console.log("📋 详细调试报告:",o);const t={客户端状态:o.matrixDiagnosis.clientExists?"已初始化":"未初始化",运行状态:o.matrixDiagnosis.clientRunning?"运行中":"已停止",同步状态:o.matrixDiagnosis.syncState||"未知",用户ID:o.matrixDiagnosis.userId||"未设置",房间数量:`客户端: ${o.matrixDiagnosis.roomCount}, 本地: ${o.storeState.roomsCount}`,网络状态:o.matrixDiagnosis.networkStatus,认证状态:o.matrixDiagnosis.authValid?"有效":"无效",建议:o.recommendations};console.log("📊 状态摘要:",t);const i=`
Matrix客户端调试信息：
• 客户端状态: ${t.客户端状态}
• 运行状态: ${t.运行状态}
• 同步状态: ${t.同步状态}
• 房间数量: ${t.房间数量}
• 网络状态: ${t.网络状态}
• 认证状态: ${t.认证状态}

${o.recommendations.length>0?`
建议:
`+o.recommendations.map(h=>"• "+h).join(`
`):""}

详细信息已输出到控制台。
    `.trim();alert(i);const f=s.matrixClient?.getRooms()||[];console.log("🏠 所有房间详情:");const L=f.filter(h=>(h.name||h.getName())==="文件传输助手"||h.roomId.includes("file-transfer")||h.getCanonicalAlias()?.includes("file-transfer"));console.log("📁 文件传输助手房间:",L.map(h=>({id:h.roomId,name:h.name||h.getName(),alias:h.getCanonicalAlias()})));const O=s.rooms.filter(h=>h.isFileTransferRoom);console.log("💾 本地文件传输助手房间:",O),console.log("🔍 过滤后的房间数量:",j.value.length),console.log("🔍 过滤后的前5个房间:",j.value.slice(0,5).map(h=>({id:h.id,name:h.name,isFileTransferRoom:h.isFileTransferRoom}))),f.forEach((h,pe)=>{console.log(`房间 ${pe+1}:`,{id:h.roomId,name:h.name||h.getName()||"无名称",alias:h.getCanonicalAlias()||"无别名",membership:h.getMyMembership(),memberCount:h.getJoinedMemberCount(),isSpace:h.isSpaceRoom(),type:h.getType()})}),s.currentRoomId&&(console.log("🔍 当前房间消息调试:"),s.debugMessages(s.currentRoomId));let ge=`Matrix客户端诊断结果:
总房间数: ${debugInfo.totalRooms}
已加入: ${debugInfo.joinedRooms}
本地存储: ${debugInfo.localRoomsCount}
同步状态: ${debugInfo.syncState}
网络连接: ${diagnosis.networkConnectivity?"正常":"异常"}
认证状态: ${diagnosis.authValid?"有效":"无效"}
当前房间: ${s.currentRoomId||"无"}`;diagnosis.recommendations.length>0&&(ge+=`

💡 建议:
`+diagnosis.recommendations.join(`
`)),alert(ge)}catch(o){console.error("❌ 获取调试信息失败:",o),alert("获取调试信息失败: "+o.message)}},be=o=>{c.value=!1},_e=async()=>{if(!s.currentRoomId){alert("请先选择一个房间");return}const o=`⚡ 快速测试消息 ${new Date().toLocaleTimeString()}`;try{console.log("🚀 测试快速消息发送...");const t=Date.now();await s.sendMatrixMessage(s.currentRoomId,o);const f=Date.now()-t;console.log(`✅ 快速消息测试完成，耗时: ${f}ms`),alert(`快速消息发送完成！
耗时: ${f}ms
内容: ${o}`)}catch(t){console.error("❌ 快速消息测试失败:",t),alert(`快速消息测试失败: ${t}`)}},$e=()=>{b.push("/encryption-settings")},we=()=>{b.push("/device-verification")},ke=async()=>{if(!l.value){l.value=!0;try{console.log("🔄 用户手动重试Matrix初始化..."),await s.retryMatrixInitialization()?console.log("✅ Matrix初始化重试成功"):(console.warn("⚠️ Matrix初始化重试失败"),alert("Matrix初始化失败，请检查网络连接或稍后重试"))}catch(o){console.error("Matrix初始化重试出错:",o),alert("重试失败，请检查网络连接")}finally{l.value=!1}}},Me=async()=>{try{const{cryptoConflictManager:o}=await Ee(async()=>{const{cryptoConflictManager:i}=await import("./cryptoConflictManager-Dn8jFaYI.js");return{cryptoConflictManager:i}},[]),t=o.detectConflicts();if(t.hasConflicts){const i=o.getConflictResolutionAdvice(t),f=`检测到加密冲突:

冲突源: ${t.conflictingSources.join(", ")}
风险级别: ${t.riskLevel}

建议:
${i.join(`
`)}`;alert(f)}else alert("✅ 未检测到加密冲突，您的加密环境是安全的。")}catch(o){console.error("检查加密冲突失败:",o),alert("检查加密冲突失败")}},Se=async o=>{if(console.log("🏗️ 开始创建群聊:",o),!s.matrixClient){console.error("❌ Matrix客户端未初始化"),alert("Matrix客户端未初始化，无法创建房间");return}try{console.log("📡 调用Matrix客户端创建房间...");const t=await s.matrixClient.createRoom(o);console.log("✅ 房间创建成功:",t);const i={id:t.room_id,name:o.name,alias:o.room_alias_name?`#${o.room_alias_name}:${s.matrixClient.getDomain()}`:"",topic:o.topic||"",type:o.visibility==="public"?"public":"private",isPublic:o.visibility==="public",memberCount:1,members:[s.matrixClient.getUserId()],unreadCount:0,encrypted:o.initial_state?.some(f=>f.type==="m.room.encryption")||!1,joinRule:o.preset==="public_chat"?"public":"invite",historyVisibility:"shared",lastActivity:Date.now(),avatarUrl:void 0};s.addRoom(i),console.log(`✅ 房间 "${i.name}" 已添加到房间列表`),await new Promise(f=>setTimeout(f,1e3));try{await s.fetchMatrixRooms()}catch(f){console.warn("刷新房间列表失败，但继续选择房间:",f)}W(i.id),x.value=!1,console.log(`房间 "${o.name}" 创建成功！`)}catch(t){console.error("❌ 创建房间失败:",t),alert("创建房间失败: "+(t?.message||"未知错误"))}},Re=async()=>{I.value=!I.value,I.value&&g.value.length===0&&await ve()},ve=async()=>{if(!s.matrixClient){console.error("Matrix客户端未初始化");return}A.value=!0;try{console.log("开始加载公共房间...");const o=await s.matrixClient.publicRooms({limit:50,server:"matrix.org"});g.value=o.chunk||[],console.log(`加载了 ${g.value.length} 个公共房间`)}catch(o){console.error("加载公共房间失败:",o);try{const t=await s.matrixClient.publicRooms({limit:50,server:"mozilla.org"});g.value=t.chunk||[],console.log(`从mozilla.org加载了 ${g.value.length} 个公共房间`)}catch(t){console.error("从备用服务器加载公共房间也失败:",t)}}finally{A.value=!1}},Ie=async o=>{if(!s.matrixClient){console.error("Matrix客户端未初始化");return}try{console.log("尝试加入房间:",o);const t=g.value.find(i=>i.room_id===o);if(await s.matrixClient.joinRoom(o),console.log("成功加入房间:",o),t){const i={id:t.room_id,name:t.name||t.canonical_alias||t.room_id,alias:t.canonical_alias,topic:t.topic,type:"public",isPublic:t.world_readable||!0,memberCount:t.num_joined_members||0,members:[],unreadCount:0,encrypted:!1,joinRule:"public",historyVisibility:"shared",avatarUrl:t.avatar_url?s.matrixClient.mxcUrlToHttp(t.avatar_url):void 0,lastActivity:Date.now()};s.addRoom(i),console.log(`✅ 房间 "${i.name}" 已添加到房间列表`),W(i.id)}I.value=!1}catch(t){console.error("加入房间失败:",t),alert("加入房间失败: "+(t?.message||"未知错误"))}};De(async()=>{if(console.log("🚀 WeChatStyleLayout 组件挂载开始"),Le(),s.matrixClient&&s.isConnected&&s.rooms.length>0){console.log("✅ Matrix客户端已存在且已连接，且有房间数据，跳过初始化");return}try{console.log("🔄 开始初始化Matrix状态...");const i=await s.initializeMatrix();if(console.log("📊 Matrix初始化结果:",i),i&&s.rooms.length>0){console.log("✅ Matrix已初始化且有房间数据，房间数量:",s.rooms.length);return}else if(i&&s.rooms.length===0){console.log("⚠️ Matrix已初始化但没有房间数据，尝试获取房间...");try{if(await s.fetchMatrixRooms(),s.rooms.length>0){console.log("✅ 成功获取房间数据，房间数量:",s.rooms.length);return}}catch(f){console.warn("获取房间失败:",f)}}}catch(i){console.error("❌ Matrix初始化失败:",i)}const o=localStorage.getItem("matrix_access_token"),t=localStorage.getItem("matrix_login_info");if(console.log("📊 检查存储的登录信息:",{hasToken:!!o,hasLoginInfo:!!t,isLoggedIn:s.isLoggedIn,hasClient:!!s.matrixClient,roomsCount:s.rooms.length}),o&&t){if(console.log("✅ 发现存储的登录信息，但可能需要重新同步"),s.rooms.length===0){console.log("🔄 有登录信息但无房间，尝试重新获取...");try{await me()}catch(i){console.warn("重新获取房间失败:",i)}}}else s.rooms.length===0?(console.log("❌ 没有找到存储的登录信息且无房间列表，跳转到登录页面"),b.push("/login")):console.log("📚 虽然没有登录信息，但有房间列表，允许界面显示")});const G=[],Le=()=>{console.log("🎯 设置滚动性能优化..."),J(()=>{try{const o=document.querySelector(".chat-list");if(o){const f=re.createOptimizedScrollListener(o,L=>{L.velocityY&&Math.abs(L.velocityY)>2&&v({message:"Fast scrolling detected in chat list",metric:"scroll_jank",value:Math.abs(L.velocityY),threshold:2,componentName:"WeChatStyleLayout",context:{scrollInfo:L}})},{throttleDelay:16,includeVelocity:!0});G.push(f)}const t=document.querySelector(".message-list");if(t){const f=re.createOptimizedScrollListener(t,L=>{},{throttleDelay:16});G.push(f)}const i=document.querySelector(".public-rooms-list");if(i){const f=re.createOptimizedScrollListener(i,L=>{},{throttleDelay:16});G.push(f)}console.log("✅ 滚动性能优化设置完成")}catch(o){console.error("❌ 滚动优化设置失败:",o),_(o,{context:"scroll_optimization_setup"})}})};return Ve(()=>{console.log("🧹 清理WeChatStyleLayout组件..."),G.forEach(o=>{try{o()}catch(t){console.error("清理滚动监听器失败:",t)}}),G.length=0,console.log("✅ WeChatStyleLayout组件清理完成")}),(o,t)=>(d(),u("div",mo,[e("div",vo,[e("div",go,[e("div",po,[e("div",fo,m(Z(D(s).currentUser?.displayName||D(s).currentUser?.username||"U")),1)])]),e("div",ho,[e("div",{class:U(["nav-item",{active:$.value==="chat"}]),title:"聊天",onClick:t[0]||(t[0]=i=>F("chat"))},t[12]||(t[12]=[e("span",{class:"nav-icon"},"💬",-1)]),2),e("div",{class:U(["nav-item",{active:$.value==="contacts"}]),title:"通讯录",onClick:t[1]||(t[1]=i=>F("contacts"))},t[13]||(t[13]=[e("span",{class:"nav-icon"},"👥",-1)]),2),e("div",{class:U(["nav-item",{active:$.value==="favorites"}]),title:"收藏",onClick:t[2]||(t[2]=i=>F("favorites"))},t[14]||(t[14]=[e("span",{class:"nav-icon"},"⭐",-1)]),2),e("div",{class:U(["nav-item",{active:$.value==="files"}]),title:"文件传输助手",onClick:t[3]||(t[3]=i=>F("files"))},t[15]||(t[15]=[e("span",{class:"nav-icon"},"📁",-1)]),2)]),t[16]||(t[16]=e("div",{class:"sidebar-footer"},[e("div",{class:"nav-item",title:"设置"},[e("span",{class:"nav-icon"},"⚙️")])],-1))]),e("div",yo,[e("div",Co,[D(s).currentUser?(d(),u("div",xo,[e("div",bo,m(Z(D(s).currentUser.displayName||D(s).currentUser.username)),1),e("span",_o,m(D(s).currentUser.displayName||D(s).currentUser.username),1)])):w("",!0),e("div",$o,[e("button",{class:"action-btn primary",onClick:n,title:"发起聊天"},t[17]||(t[17]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1)])),e("button",{class:"action-btn primary",onClick:a,title:"创建群聊"},t[18]||(t[18]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-1c0-2.66 5.33-4 8-4s8 1.34 8 4v1H4zM12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"})],-1)])),e("button",{class:"action-btn primary",onClick:r,title:"加入房间"},t[19]||(t[19]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)])),e("div",{class:"more-actions",ref_key:"moreActionsRef",ref:ne},[e("button",{class:U(["action-btn more-btn",{active:B.value}]),onClick:ie,title:"更多操作"},t[20]||(t[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)]),2),B.value?(d(),u("div",wo,[e("button",{class:"menu-item",onClick:Re},t[21]||(t[21]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})],-1),z(" 探索房间 ")])),e("button",{class:"menu-item",onClick:me},t[22]||(t[22]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1),z(" 刷新房间 ")])),t[30]||(t[30]=e("div",{class:"menu-divider"},null,-1)),e("button",{class:"menu-item",onClick:xe},t[23]||(t[23]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.42.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8z"})],-1),z(" 调试工具 ")])),e("button",{class:"menu-item",onClick:Ce},t[24]||(t[24]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),z(" 强制创建文件助手 ")])),e("button",{class:"menu-item",onClick:t[4]||(t[4]=(...i)=>o.forceSync&&o.forceSync(...i))},t[25]||(t[25]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z"})],-1),z(" 强制同步 ")])),e("button",{class:"menu-item",onClick:_e},t[26]||(t[26]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M7 14l5-5 5 5z"})],-1),z(" 测试消息 ")])),e("button",{class:"menu-item",onClick:$e},t[27]||(t[27]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})],-1),z(" 加密设置 ")])),e("button",{class:"menu-item",onClick:we},t[28]||(t[28]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"})],-1),z(" 设备验证 ")])),e("button",{class:"menu-item",onClick:Me},t[29]||(t[29]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"})],-1),z(" 检查冲突 ")]))])):w("",!0)],512)])]),e("div",ko,[e("div",Mo,[t[31]||(t[31]=e("span",{class:"search-icon"},"🔍",-1)),V(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=i=>M.value=i),placeholder:"搜索",class:"search-input"},null,512),[[H,M.value]])])]),e("div",So,[D(s).loading&&D(s).rooms.length===0?(d(),u("div",Ro,t[32]||(t[32]=[e("div",{class:"loading-spinner"},null,-1),e("div",{class:"loading-message"},"正在加载聊天列表...",-1)]))):w("",!0),!D(s).matrixClient&&!D(s).loading?(d(),u("div",Io,[t[33]||(t[33]=e("div",{class:"warning-icon"},"⚠️",-1)),t[34]||(t[34]=e("div",{class:"warning-message"},"Matrix客户端未初始化",-1)),t[35]||(t[35]=e("div",{class:"warning-description"},"请检查网络连接或尝试重新初始化",-1)),e("button",{onClick:ke,class:"retry-button",disabled:l.value},m(l.value?"重试中...":"🔄 重试初始化"),9,Lo)])):j.value.length===0?(d(),u("div",To,t[36]||(t[36]=[e("div",{class:"empty-message"},"暂无聊天",-1)]))):w("",!0),(d(!0),u(K,null,q(j.value,i=>(d(),u("div",{key:i.id,class:U(["chat-item",{active:R.value===i.id}]),onClick:f=>W(i.id)},[e("div",zo,m(Q(i.name)),1),e("div",Vo,[e("div",Eo,[e("span",Ho,m(i.name),1),i.lastEventTimestamp?(d(),u("span",Uo,m(ae(i.lastEventTimestamp)),1)):w("",!0)]),e("div",No,[e("span",Ao,m(i.lastMessage||"暂无消息"),1),e("div",Bo,[i.unreadCount>0?(d(),u("span",jo,m(i.unreadCount),1)):w("",!0)])])])],10,Do))),128))]),e("div",{class:"chat-list-footer"},[e("button",{class:"logout-btn",onClick:le,title:"退出登录"},t[37]||(t[37]=[e("span",{class:"logout-icon"},"🚪",-1),e("span",{class:"logout-text"},"退出",-1)]))])]),e("div",Fo,[R.value?(d(),u("div",Wo,[e("div",Go,[de(wt,{"room-id":R.value},null,8,["room-id"])])])):(d(),u("div",Po,t[38]||(t[38]=[e("div",{class:"welcome-chat"},[e("div",{class:"icon-message-large"},"💬"),e("h2",null,"选择一个对话"),e("p",null,"从左侧选择一个聊天开始对话")],-1)])))]),I.value?(d(),u("div",Oo,[e("div",Jo,[t[39]||(t[39]=e("h3",null,"探索公共房间",-1)),e("button",{class:"close-btn",onClick:t[6]||(t[6]=i=>I.value=!1)},"×")]),e("div",Ko,[e("div",qo,[V(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=i=>C.value=i),placeholder:"搜索公共房间...",class:"search-input"},null,512),[[H,C.value]])]),e("div",Yo,[A.value?(d(),u("div",Zo,t[40]||(t[40]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在加载公共房间...",-1)]))):P.value.length>0?(d(),u("div",Qo,[(d(!0),u(K,null,q(P.value,i=>(d(),u("div",{key:i.room_id,class:"public-room-item"},[e("div",Xo,m(Q(i.name||i.canonical_alias||i.room_id)),1),e("div",es,[e("div",ts,m(i.name||i.canonical_alias||i.room_id),1),e("div",os,m(i.topic||"无描述"),1),e("div",ss,m(i.num_joined_members||0)+" 成员",1)]),e("div",ns,[e("button",{class:"join-btn",onClick:f=>Ie(i.room_id)}," 加入 ",8,is)])]))),128))])):(d(),u("div",ls,[t[41]||(t[41]=e("div",{class:"empty-icon"},"🏠",-1)),t[42]||(t[42]=e("p",null,"没有找到公共房间",-1)),e("button",{class:"retry-btn",onClick:ve},"重新加载")]))])])])):w("",!0),c.value?(d(),ce(Ft,{key:1,onClose:t[8]||(t[8]=i=>c.value=!1),onStartDm:be})):w("",!0),x.value?(d(),ce(uo,{key:2,onClose:t[9]||(t[9]=i=>x.value=!1),onCreateGroup:Se})):w("",!0),E.value?(d(),u("div",{key:3,class:"modal-overlay",onClick:S},[e("div",{class:"modal-content",onClick:t[11]||(t[11]=ue(()=>{},["stop"]))},[e("div",{class:"modal-header"},[t[43]||(t[43]=e("h3",null,"🏠 加入房间",-1)),e("button",{class:"close-btn",onClick:S},"✕")]),e("div",as,[e("div",rs,[t[44]||(t[44]=e("label",null,"房间地址",-1)),V(e("input",{"onUpdate:modelValue":t[10]||(t[10]=i=>T.value=i),type:"text",placeholder:"输入房间别名或ID，如：#friesport:mozilla.org",class:"room-input",onKeyup:ee(X,["enter"])},null,544),[[H,T.value]]),t[45]||(t[45]=e("div",{class:"input-hint"}," 支持房间别名（#roomname:server.org）或房间ID（!roomid:server.org） ",-1))])]),e("div",cs,[e("button",{class:"cancel-btn",onClick:S},"取消"),e("button",{class:"join-btn primary",onClick:X,disabled:!T.value.trim()||p.value},m(p.value?"加入中...":"加入房间"),9,ds)])])])):w("",!0)]))}}),ps=se(us,[["__scopeId","data-v-15a06312"]]);export{ps as default};
