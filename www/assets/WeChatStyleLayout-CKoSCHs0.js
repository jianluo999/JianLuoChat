import{j as te,f as oe,g as y,h as N,k as fe,c as u,b as w,a as e,l as ce,m as de,t as m,F as K,r as q,n as U,p as J,o as d,_ as se,e as z,w as V,v as H,d as ee,q as ue,s as he,x as Te,y as De,i as ze,z as re,A as Ve,B as D,C as Ee}from"./index-Cl5nGqgc.js";import{M as He}from"./MatrixMessageInput-DhpyKYJ-.js";import{E as ye}from"./EncryptionIndicator-DOmuLn2f.js";const Ue={class:"matrix-message-area"},Ne={key:0,class:"matrix-room-header"},Ae={class:"room-info"},Be={class:"room-title"},je={class:"room-name"},Fe={class:"room-id"},Pe={key:0,class:"no-room-selected"},We={key:1,class:"loading-messages"},Ge={key:2,class:"messages-list"},Oe={key:0,class:"empty-messages"},Je={class:"empty-icon"},Ke={class:"empty-text"},qe={class:"empty-title"},Ye={class:"empty-desc"},Ze={key:0,class:"message-avatar"},Qe={class:"avatar-placeholder"},Xe={class:"message-main"},et={key:0,class:"message-header"},tt={class:"sender-name"},ot={class:"message-timestamp"},st={class:"message-content"},nt={key:0,class:"system-message-content"},it={class:"system-text"},lt={key:1,class:"regular-message-content"},at={class:"message-bubble"},rt={key:0,class:"file-message"},ct={key:0,class:"image-preview"},dt=["src","alt","onClick"],ut={class:"file-info"},mt={class:"file-icon"},vt={class:"file-details"},gt={class:"file-name"},pt={class:"file-size"},ft={class:"file-actions"},ht=["onClick"],yt=["innerHTML"],Ct={key:2,class:"message-text"},xt={class:"message-meta"},bt={class:"message-time"},_t={key:2,class:"no-send-permission"},$t=te({__name:"MatrixMessageAreaSimple",props:{roomId:{}},setup(Y){const s=Y,b=oe(),_=y(),k=y(!1),v=N(()=>s.roomId?b.rooms.find(n=>n.id===s.roomId):null),R=N(()=>s.roomId?(b.messageUpdateTrigger,b.messages.get(s.roomId)||[]):[]),$=n=>n.sender===b.currentUser?.id,M=n=>n.type!=="m.room.message",C=n=>n?n.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2):"?",c=n=>n.senderName||n.sender.split(":")[0].substring(1),x=n=>{const a=new Date(n),S=new Date().getTime()-a.getTime();return S<6e4?"åˆšåˆš":S<36e5?`${Math.floor(S/6e4)}åˆ†é’Ÿå‰`:S<864e5?a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):a.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},I=n=>n?n.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/<iframe[^>]*>.*?<\/iframe>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,""):"",E=()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)},T=async()=>{if(!(!v.value||k.value))try{const n=_.value;if(!n)return;if(n.scrollHeight<=n.clientHeight){console.log("å†…å®¹æœªå¡«æ»¡ï¼Œæš‚ä¸åŠ è½½æ›´å¤š");return}k.value=!0,console.log("ğŸ“š åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯...");const a=n.scrollHeight,r=n.scrollTop;await b.loadMoreHistoryMessages(v.value.id),J(()=>{if(n){const X=n.scrollHeight-a;n.scrollTop=r+X}})}catch(n){console.error("åŠ è½½å†å²æ¶ˆæ¯å¤±è´¥:",n)}finally{k.value=!1}};let p=null,l=!1;const g=n=>{const a=n.target;!a||k.value||l||p||(p=window.setTimeout(async()=>{p=null,a.scrollTop<50&&(l=!0,await T(),l=!1)},500))},A=async n=>{if(!(!n.trim()||!v.value))try{await b.sendMatrixMessage(v.value.id,n),J(()=>{E()})}catch(a){console.error("Failed to send message:",a);const r=a.message||"å‘é€æ¶ˆæ¯å¤±è´¥";r.includes("åŠ å¯†")?alert(`âš ï¸ åŠ å¯†æˆ¿é—´æš‚ä¸æ”¯æŒ

`+r):alert("âŒ å‘é€å¤±è´¥: "+r)}},B=()=>{if(!v.value)return"ğŸ’¬";const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a&&!a.maySendMessage())return"ğŸ”’"}return"ğŸ’¬"},ne=()=>{if(!v.value)return"è¿˜æ²¡æœ‰æ¶ˆæ¯";const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a&&!a.maySendMessage())return"åªè¯»æˆ¿é—´"}return"è¿˜æ²¡æœ‰æ¶ˆæ¯"},j=()=>{if(!v.value)return"æˆä¸ºç¬¬ä¸€ä¸ªåœ¨è¿™ä¸ªæˆ¿é—´å‘è¨€çš„äººå§ï¼";const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a&&!a.maySendMessage())return"æ‚¨åœ¨æ­¤æˆ¿é—´åªæœ‰æŸ¥çœ‹æƒé™ï¼Œæ— æ³•å‘é€æ¶ˆæ¯"}return"æˆä¸ºç¬¬ä¸€ä¸ªåœ¨è¿™ä¸ªæˆ¿é—´å‘è¨€çš„äººå§ï¼"},P=N(()=>{if(!v.value)return!1;const n=b.matrixClient;if(n){const a=n.getRoom(v.value.id);if(a)return a.maySendMessage()}return!0}),F=()=>0,ie=()=>1,le=()=>{if(v.value?.encrypted)return"m.megolm.v1.aes-sha2"},Z=n=>{if(n===0)return"0 Bytes";const a=1024,r=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(n)/Math.log(a));return parseFloat((n/Math.pow(a,S)).toFixed(2))+" "+r[S]},Q=n=>n.startsWith("image/")?"ğŸ–¼ï¸":n.startsWith("video/")?"ğŸ¥":n.startsWith("audio/")?"ğŸµ":n.includes("pdf")?"ğŸ“„":n.includes("word")||n.includes("doc")?"ğŸ“":n.includes("excel")||n.includes("sheet")?"ğŸ“Š":n.includes("powerpoint")||n.includes("presentation")?"ğŸ“½ï¸":n.includes("zip")||n.includes("rar")||n.includes("7z")?"ğŸ“¦":"ğŸ“",ae=n=>{const a=document.createElement("div");a.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    cursor: pointer;
  `;const r=document.createElement("img");r.src=n.url,r.style.cssText=`
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
  `,a.appendChild(r),document.body.appendChild(a),a.onclick=()=>{document.body.removeChild(a)}},W=n=>{const a=document.createElement("a");a.href=n.url,a.download=n.name,document.body.appendChild(a),a.click(),document.body.removeChild(a)};return fe(()=>s.roomId,async(n,a)=>{if(n&&n!==a){console.log(`ğŸ”„ æˆ¿é—´åˆ‡æ¢: ${a} -> ${n}`);try{k.value=!0,await b.fetchMatrixMessages(n),b.markRoomAsRead(n),J(()=>{E()})}catch(r){console.error("Failed to load room messages:",r)}finally{k.value=!1}}},{immediate:!0}),fe(()=>R.value,(n,a)=>{J(()=>{const r=_.value;if(!r)return;r.scrollHeight-r.scrollTop-r.clientHeight<100&&n&&a&&n.length>a.length&&E()})},{deep:!0}),(n,a)=>(d(),u("div",Ue,[v.value?(d(),u("div",Ne,[e("div",Ae,[e("div",Be,[e("div",je,m(v.value.name),1),e("div",Fe,m(v.value.id),1)]),de(ye,{type:"room",encrypted:v.value.encrypted,"member-count":v.value.memberCount,"verified-devices":F(),"total-devices":ie(),algorithm:le()},null,8,["encrypted","member-count","verified-devices","total-devices","algorithm"])])])):w("",!0),e("div",{class:"matrix-messages-container",ref_key:"messagesContainer",ref:_,onScroll:g},[v.value?k.value?(d(),u("div",We,a[1]||(a[1]=[e("div",{class:"loading-spinner"},"â³",-1),e("div",{class:"loading-text"},"åŠ è½½æ¶ˆæ¯ä¸­...",-1)]))):(d(),u("div",Ge,[R.value.length===0?(d(),u("div",Oe,[e("div",Je,m(B()),1),e("div",Ke,[e("div",qe,m(ne()),1),e("div",Ye,m(j()),1)])])):w("",!0),(d(!0),u(K,null,q(R.value,r=>(d(),u("div",{key:r.id,class:U(["message-item",{"own-message":$(r),"system-message":M(r)}])},[!$(r)&&!M(r)?(d(),u("div",Ze,[e("div",Qe,m(C(r.sender)),1)])):w("",!0),e("div",Xe,[!$(r)&&!M(r)?(d(),u("div",et,[e("span",tt,m(c(r)),1),e("span",ot,m(x(r.timestamp)),1)])):w("",!0),e("div",st,[M(r)?(d(),u("div",nt,[a[2]||(a[2]=e("span",{class:"system-icon"},"â„¹ï¸",-1)),e("span",it,m(r.content),1)])):(d(),u("div",lt,[e("div",at,[r.fileInfo?(d(),u("div",rt,[r.fileInfo.isImage&&r.fileInfo.url?(d(),u("div",ct,[e("img",{src:r.fileInfo.url,alt:r.fileInfo.name,onClick:S=>ae(r.fileInfo)},null,8,dt)])):w("",!0),e("div",ut,[e("div",mt,m(r.fileInfo.isImage?"ğŸ–¼ï¸":Q(r.fileInfo.type)),1),e("div",vt,[e("div",gt,m(r.fileInfo.name),1),e("div",pt,m(Z(r.fileInfo.size)),1)]),e("div",ft,[e("button",{onClick:S=>W(r.fileInfo),class:"download-btn"}," ğŸ“¥ ",8,ht)])])])):r.formattedContent&&r.format==="org.matrix.custom.html"?(d(),u("div",{key:1,class:"message-text formatted-message",innerHTML:I(r.formattedContent)},null,8,yt)):(d(),u("div",Ct,m(r.content),1))]),e("div",xt,[e("span",bt,m(x(r.timestamp)),1),de(ye,{type:"message",encrypted:r.encrypted,decrypted:!r.decryptionError,"decryption-error":r.decryptionError},null,8,["encrypted","decrypted","decryption-error"])])]))])])],2))),128))])):(d(),u("div",Pe,a[0]||(a[0]=[e("div",{class:"welcome-content"},[e("div",{class:"welcome-message"},[e("h2",null,"æ¬¢è¿ä½¿ç”¨Matrix"),e("p",null,"é€‰æ‹©ä¸€ä¸ªæˆ¿é—´å¼€å§‹èŠå¤©")])],-1)])))],544),v.value&&P.value?(d(),ce(He,{key:1,"room-id":v.value.id,placeholder:`å‘é€æ¶ˆæ¯åˆ° ${v.value.name}...`,onSendMessage:A},null,8,["room-id","placeholder"])):v.value&&!P.value?(d(),u("div",_t," ğŸ”’ æ‚¨åœ¨æ­¤æˆ¿é—´åªæœ‰æŸ¥çœ‹æƒé™ï¼Œæ— æ³•å‘é€æ¶ˆæ¯ ")):w("",!0)]))}}),wt=se($t,[["__scopeId","data-v-2d53faf1"]]),kt={class:"modal-header"},Mt={class:"modal-content"},St={class:"user-input-section"},Rt={key:0,class:"recent-contacts"},It={class:"contacts-list"},Lt=["onClick"],Tt={class:"contact-avatar"},Dt={class:"contact-info"},zt={class:"contact-name"},Vt={class:"contact-id"},Et={class:"server-suggestion"},Ht={class:"server-links"},Ut={class:"server-link"},Nt={class:"server-link"},At={class:"modal-footer"},Bt=["disabled"],jt=te({__name:"StartDirectMessageDialog",emits:["close","start-dm"],setup(Y,{emit:s}){const b=s;oe();const _=y(""),k=N(()=>[{userId:"@alice:matrix.org",displayName:"Alice"},{userId:"@bob:element.io",displayName:"Bob"}]),v=C=>C.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2),R=C=>{_.value=C},$=()=>{if(_.value.trim()){if(!_.value.startsWith("@")||!_.value.includes(":")){alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç”¨æˆ·IDæ ¼å¼ï¼š@username:server.com");return}b("start-dm",_.value.trim())}},M=async C=>{try{await navigator.clipboard.writeText(C),console.log("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿:",C)}catch(c){console.error("å¤åˆ¶å¤±è´¥:",c)}};return(C,c)=>(d(),u("div",{class:"modal-overlay",onClick:c[6]||(c[6]=x=>C.$emit("close"))},[e("div",{class:"modal start-dm-modal",onClick:c[5]||(c[5]=ue(()=>{},["stop"]))},[e("div",kt,[c[7]||(c[7]=e("h2",null,"å¼€å§‹ç§èŠ",-1)),e("button",{class:"close-btn",onClick:c[0]||(c[0]=x=>C.$emit("close"))},"Ã—")]),e("div",Mt,[c[15]||(c[15]=e("div",{class:"modal-description"},[e("p",null,[z("è¾“å…¥ç”¨æˆ·IDå¼€å§‹ç§èŠå¯¹è¯ã€‚ç”¨æˆ·IDæ ¼å¼ä¸º "),e("span",{class:"user-id-example"},"@username:server.com")])],-1)),e("div",St,[c[8]||(c[8]=e("label",{for:"userId"},"ç”¨æˆ·ID",-1)),V(e("input",{id:"userId",type:"text","onUpdate:modelValue":c[1]||(c[1]=x=>_.value=x),placeholder:"@user:matrix.org",class:"user-input",onKeyup:ee($,["enter"])},null,544),[[H,_.value]])]),c[16]||(c[16]=e("div",{class:"dm-tips"},[e("h4",null,"éšç§æç¤º"),e("p",null,"â€¢ ç§èŠæ¶ˆæ¯åªæœ‰ä½ å’Œå¯¹æ–¹èƒ½çœ‹åˆ°"),e("p",null,"â€¢ å¯¹æ–¹ä¼šæ”¶åˆ°ä½ çš„èŠå¤©é‚€è¯·"),e("p",null,"â€¢ å¯¹æ–¹éœ€è¦æ¥å—é‚€è¯·æ‰èƒ½å¼€å§‹å¯¹è¯")],-1)),k.value.length>0?(d(),u("div",Rt,[c[9]||(c[9]=e("h4",null,"æœ€è¿‘è”ç³»äºº",-1)),e("div",It,[(d(!0),u(K,null,q(k.value,x=>(d(),u("div",{key:x.userId,class:"contact-item",onClick:I=>R(x.userId)},[e("div",Tt,m(v(x.displayName||x.userId)),1),e("div",Dt,[e("div",zt,m(x.displayName||x.userId),1),e("div",Vt,m(x.userId),1)])],8,Lt))),128))])])):w("",!0),e("div",Et,[c[14]||(c[14]=e("p",null,"éœ€è¦å¸®åŠ©æ‰¾åˆ°ç”¨æˆ·ï¼Ÿè¯•è¯•è¿™äº›MatrixæœåŠ¡å™¨ï¼š",-1)),e("div",Ht,[e("div",Ut,[c[11]||(c[11]=e("a",{href:"https://matrix.org",target:"_blank"},"matrix.org",-1)),e("button",{class:"copy-btn",onClick:c[2]||(c[2]=x=>M("matrix.org"))},c[10]||(c[10]=[e("i",{class:"icon-copy"},null,-1)]))]),e("div",Nt,[c[13]||(c[13]=e("a",{href:"https://element.io",target:"_blank"},"element.io",-1)),e("button",{class:"copy-btn",onClick:c[3]||(c[3]=x=>M("element.io"))},c[12]||(c[12]=[e("i",{class:"icon-copy"},null,-1)]))])])])]),e("div",At,[e("button",{class:"btn-secondary",onClick:c[4]||(c[4]=x=>C.$emit("close"))},"å–æ¶ˆ"),e("button",{class:"btn-primary",onClick:$,disabled:!_.value.trim()}," å¼€å§‹ç§èŠ ",8,Bt)])])]))}}),Ft=se(jt,[["__scopeId","data-v-62a3f561"]]),Pt={class:"modal-header"},Wt={class:"modal-content"},Gt={class:"form-section"},Ot={class:"form-section"},Jt={class:"form-section"},Kt={class:"checkbox-group"},qt={class:"checkbox-item"},Yt={class:"checkbox-item"},Zt={key:0,class:"form-section"},Qt={class:"alias-input-group"},Xt={class:"alias-suffix"},eo={class:"form-section"},to={class:"invite-section"},oo={class:"invite-input-group"},so=["disabled"],no={key:0,class:"invited-users"},io={class:"user-id"},lo=["onClick"],ao={class:"modal-footer"},ro=["disabled"],co=te({__name:"CreateGroupChatDialog",emits:["close","create-group"],setup(Y,{emit:s}){const b=s,_=oe(),k=y(""),v=y(""),R=y(""),$=y(!1),M=y(!0),C=y(""),c=y([]),x=N(()=>{const p=_.currentUser;return p&&p.username.includes(":")?p.username.split(":")[1]:"matrix.org"}),I=()=>{const p=C.value.trim();if(p){if(!p.startsWith("@")||!p.includes(":")){alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç”¨æˆ·IDæ ¼å¼ï¼š@username:server.com");return}c.value.includes(p)||(c.value.push(p),C.value="")}},E=p=>{const l=c.value.indexOf(p);l>-1&&c.value.splice(l,1)},T=()=>{if(!k.value.trim())return;const p={name:k.value.trim(),topic:v.value.trim(),visibility:$.value?"public":"private",room_alias_name:$.value&&R.value?R.value:void 0,initial_state:M.value?[{type:"m.room.encryption",content:{algorithm:"m.megolm.v1.aes-sha2"}}]:[],invite:c.value,preset:$.value?"public_chat":"private_chat"};b("create-group",p)};return(p,l)=>(d(),u("div",{class:"modal-overlay",onClick:l[9]||(l[9]=g=>p.$emit("close"))},[e("div",{class:"modal create-group-modal",onClick:l[8]||(l[8]=ue(()=>{},["stop"]))},[e("div",Pt,[l[10]||(l[10]=e("h2",null,"åˆ›å»ºç¾¤èŠ",-1)),e("button",{class:"close-btn",onClick:l[0]||(l[0]=g=>p.$emit("close"))},"Ã—")]),e("div",Wt,[e("div",Gt,[l[11]||(l[11]=e("label",{for:"roomName"},"æˆ¿é—´åç§° *",-1)),V(e("input",{id:"roomName",type:"text","onUpdate:modelValue":l[1]||(l[1]=g=>k.value=g),placeholder:"è¾“å…¥æˆ¿é—´åç§°",class:"form-input",onKeyup:ee(T,["enter"])},null,544),[[H,k.value]])]),e("div",Ot,[l[12]||(l[12]=e("label",{for:"roomTopic"},"æˆ¿é—´æè¿°",-1)),V(e("textarea",{id:"roomTopic","onUpdate:modelValue":l[2]||(l[2]=g=>v.value=g),placeholder:"æè¿°è¿™ä¸ªæˆ¿é—´çš„ç”¨é€”ï¼ˆå¯é€‰ï¼‰",class:"form-textarea",rows:"3"},null,512),[[H,v.value]])]),e("div",Jt,[l[17]||(l[17]=e("label",null,"æˆ¿é—´è®¾ç½®",-1)),e("div",Kt,[e("label",qt,[V(e("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=g=>$.value=g)},null,512),[[he,$.value]]),l[13]||(l[13]=e("span",{class:"checkbox-label"},"å…¬å¼€æˆ¿é—´",-1)),l[14]||(l[14]=e("span",{class:"checkbox-desc"},"ä»»ä½•äººéƒ½å¯ä»¥æ‰¾åˆ°å¹¶åŠ å…¥",-1))]),e("label",Yt,[V(e("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=g=>M.value=g)},null,512),[[he,M.value]]),l[15]||(l[15]=e("span",{class:"checkbox-label"},"å¯ç”¨ç«¯åˆ°ç«¯åŠ å¯†",-1)),l[16]||(l[16]=e("span",{class:"checkbox-desc"},"ä¿æŠ¤æ¶ˆæ¯éšç§ï¼ˆæ¨èï¼‰",-1))])])]),$.value?(d(),u("div",Zt,[l[19]||(l[19]=e("label",{for:"roomAlias"},"æˆ¿é—´åœ°å€",-1)),e("div",Qt,[l[18]||(l[18]=e("span",{class:"alias-prefix"},"#",-1)),V(e("input",{id:"roomAlias",type:"text","onUpdate:modelValue":l[5]||(l[5]=g=>R.value=g),placeholder:"room-name",class:"form-input alias-input"},null,512),[[H,R.value]]),e("span",Xt,":"+m(x.value),1)]),l[20]||(l[20]=e("div",{class:"form-hint"}," æˆ¿é—´åœ°å€ç”¨äºå…¶ä»–äººæ‰¾åˆ°å’ŒåŠ å…¥è¿™ä¸ªæˆ¿é—´ ",-1))])):w("",!0),e("div",eo,[l[21]||(l[21]=e("label",null,"é‚€è¯·ç”¨æˆ·",-1)),e("div",to,[e("div",oo,[V(e("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=g=>C.value=g),placeholder:"@user:matrix.org",class:"form-input",onKeyup:ee(I,["enter"])},null,544),[[H,C.value]]),e("button",{class:"btn-secondary",onClick:I,disabled:!C.value.trim()}," æ·»åŠ  ",8,so)]),c.value.length>0?(d(),u("div",no,[(d(!0),u(K,null,q(c.value,g=>(d(),u("div",{key:g,class:"invited-user"},[e("span",io,m(g),1),e("button",{class:"remove-btn",onClick:A=>E(g)},"Ã—",8,lo)]))),128))])):w("",!0)])]),l[22]||(l[22]=e("div",{class:"creation-tips"},[e("h4",null,"åˆ›å»ºæç¤º"),e("p",null,"â€¢ æˆ¿é—´åˆ›å»ºåï¼Œä½ å°†æˆä¸ºæˆ¿é—´ç®¡ç†å‘˜"),e("p",null,"â€¢ ä½ å¯ä»¥éšæ—¶ä¿®æ”¹æˆ¿é—´è®¾ç½®å’Œé‚€è¯·æ›´å¤šç”¨æˆ·"),e("p",null,"â€¢ å…¬å¼€æˆ¿é—´ä¼šå‡ºç°åœ¨æˆ¿é—´ç›®å½•ä¸­")],-1))]),e("div",ao,[e("button",{class:"btn-secondary",onClick:l[7]||(l[7]=g=>p.$emit("close"))},"å–æ¶ˆ"),e("button",{class:"btn-primary",onClick:T,disabled:!k.value.trim()}," åˆ›å»ºæˆ¿é—´ ",8,ro)])])]))}}),uo=se(co,[["__scopeId","data-v-0ce406e8"]]),mo={class:"wechat-layout"},vo={class:"wechat-sidebar"},go={class:"sidebar-header"},po={class:"user-avatar-nav"},fo={class:"avatar-placeholder-nav"},ho={class:"sidebar-nav"},yo={class:"chat-list-panel"},Co={class:"chat-list-header"},xo={key:0,class:"user-info"},bo={class:"user-avatar"},_o={class:"username"},$o={class:"header-actions"},wo={key:0,class:"more-menu"},ko={class:"search-container"},Mo={class:"search-box"},So={class:"chat-list"},Ro={key:0,class:"loading-chat-list"},Io={key:1,class:"matrix-client-warning"},Lo=["disabled"],To={key:2,class:"empty-chat-list"},Do=["onClick"],zo={class:"chat-avatar"},Vo={class:"chat-content"},Eo={class:"chat-header"},Ho={class:"chat-name"},Uo={key:0,class:"chat-time"},No={class:"chat-preview"},Ao={class:"last-message"},Bo={class:"chat-badges"},jo={key:0,class:"unread-count"},Fo={class:"chat-panel"},Po={key:0,class:"no-chat-selected"},Wo={key:1,class:"active-chat-container"},Go={class:"message-list"},Oo={key:0,class:"explore-panel"},Jo={class:"explore-header"},Ko={class:"explore-content"},qo={class:"search-bar"},Yo={class:"public-rooms-list"},Zo={key:0,class:"loading-state"},Qo={key:1},Xo={class:"room-avatar"},es={class:"room-info"},ts={class:"room-name"},os={class:"room-topic"},ss={class:"room-members"},ns={class:"room-actions"},is=["onClick"],ls={key:2,class:"empty-state"},as={class:"modal-body"},rs={class:"input-group"},cs={class:"modal-footer"},ds=["disabled"],us=te({__name:"WeChatStyleLayout",setup(Y){const s=oe(),b=ze(),{handleError:_,handleMatrixError:k,handlePerformanceError:v}=Te(),R=y(""),$=y("chat"),M=y(""),C=y(""),c=y(!1),x=y(!1),I=y(!1),E=y(!1),T=y(""),p=y(!1),l=y(!1),g=y([]),A=y(!1),B=y(!1),ne=y(),j=N(()=>{const o=s.rooms||[];return M.value?o.filter(t=>t.name.toLowerCase().includes(M.value.toLowerCase())):o}),P=N(()=>C.value?g.value.filter(o=>(o.name||"").toLowerCase().includes(C.value.toLowerCase())||(o.topic||"").toLowerCase().includes(C.value.toLowerCase())):g.value),F=o=>{$.value=o,console.log("åˆ‡æ¢åˆ°å¯¼èˆª:",o)},ie=()=>{B.value=!B.value},le=()=>{console.log("é€€å‡ºæŒ‰é’®è¢«ç‚¹å‡»äº†");try{console.log("å¼€å§‹æ¸…é™¤MatrixçŠ¶æ€..."),s.logout(),console.log("MatrixçŠ¶æ€å·²æ¸…é™¤"),console.log("å‡†å¤‡è·³è½¬åˆ°ç™»å½•é¡µé¢..."),b.push("/login"),console.log("è·¯ç”±è·³è½¬å‘½ä»¤å·²å‘é€")}catch(o){console.error("é€€å‡ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:",o),window.location.href="/login"}},Z=o=>o.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),Q=o=>o.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),ae=o=>{const t=new Date(o);return new Date().getTime()-t.getTime()<24*60*60*1e3?t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},W=async o=>{if(R.value=o,s.setCurrentRoom(o),s.matrixClient&&!s.matrixClient.getRoom(o)){console.log(`ğŸ”„ æˆ¿é—´ ${o} ä¸å­˜åœ¨ï¼Œå°è¯•åˆ·æ–°æˆ¿é—´åˆ—è¡¨...`);try{await s.fetchMatrixRooms(),console.log("âœ… æˆ¿é—´åˆ—è¡¨åˆ·æ–°å®Œæˆ")}catch(i){console.warn("æˆ¿é—´åˆ—è¡¨åˆ·æ–°å¤±è´¥:",i)}}try{console.log(`ğŸ”„ é€‰æ‹©æˆ¿é—´: ${o}ï¼Œå¼€å§‹åŠ è½½æ¶ˆæ¯...`),await s.fetchMatrixMessages(o),console.log(`âœ… æˆ¿é—´ ${o} æ¶ˆæ¯åŠ è½½å®Œæˆ`)}catch(t){console.error("Failed to load room messages:",t)}},n=()=>{c.value=!0},a=()=>{x.value=!0},r=()=>{E.value=!0,T.value=""},S=()=>{E.value=!1,T.value="",p.value=!1},X=async()=>{const o=T.value.trim();if(o){if(!s.matrixClient){alert("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œæ— æ³•åŠ å…¥æˆ¿é—´");return}p.value=!0;try{console.log(`ğŸ  å°è¯•åŠ å…¥æˆ¿é—´: ${o}`),await s.matrixClient.joinRoom(o),console.log(`âœ… æˆåŠŸåŠ å…¥æˆ¿é—´: ${o}`),await s.fetchMatrixRooms(),S(),alert(`âœ… æˆåŠŸåŠ å…¥æˆ¿é—´: ${o}`)}catch(t){console.error("âŒ åŠ å…¥æˆ¿é—´å¤±è´¥:",t),alert(`âŒ åŠ å…¥æˆ¿é—´å¤±è´¥: ${t.message||"æœªçŸ¥é”™è¯¯"}`)}finally{p.value=!1}}},Ce=async()=>{if(console.log("ğŸ”§ å¼ºåˆ¶åˆ›å»ºæ–‡ä»¶ä¼ è¾“åŠ©æ‰‹..."),!s.matrixClient){console.error("âŒ Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–"),alert("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œæ— æ³•åˆ›å»ºæ–‡ä»¶ä¼ è¾“åŠ©æ‰‹");return}try{s.loading=!0;const o=s.ensureFileTransferRoom();console.log("âœ… æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹åˆ›å»ºå®Œæˆ:",o),await s.fetchMatrixRooms(),alert("æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹åˆ›å»ºæˆåŠŸï¼")}catch(o){console.error("âŒ åˆ›å»ºæ–‡ä»¶ä¼ è¾“åŠ©æ‰‹å¤±è´¥:",o),alert("åˆ›å»ºæ–‡ä»¶ä¼ è¾“åŠ©æ‰‹å¤±è´¥: "+(o?.message||"æœªçŸ¥é”™è¯¯"))}finally{s.loading=!1}},me=async()=>{if(console.log("ğŸ”„ æ‰‹åŠ¨åˆ·æ–°æˆ¿é—´åˆ—è¡¨..."),!s.matrixClient){console.error("âŒ Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–"),k({message:"Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œæ— æ³•åˆ·æ–°æˆ¿é—´",operation:"sync",isRecoverable:!0});return}try{if(s.loading=!0,console.log("ğŸš€ å°è¯•ç›´æ¥è·å–æˆ¿é—´åˆ—è¡¨..."),await s.fetchMatrixRooms(),s.rooms.length>0){console.log(`âœ… ç›´æ¥è·å–æˆåŠŸï¼Œæ‰¾åˆ° ${s.rooms.length} ä¸ªæˆ¿é—´`);return}const o=s.matrixClient.getSyncState();console.log(`ğŸ“¡ å½“å‰åŒæ­¥çŠ¶æ€: ${o}`),(o==="STOPPED"||o==="ERROR"||o===null)&&(console.log("ğŸš€ åŒæ­¥çŠ¶æ€ä¸ä½³ï¼Œé‡æ–°å¯åŠ¨Matrixå®¢æˆ·ç«¯..."),s.matrixClient.clientRunning&&(s.matrixClient.stopClient(),await new Promise(t=>setTimeout(t,1e3))),await s.matrixClient.startClient({initialSyncLimit:100,lazyLoadMembers:!0}),console.log("â³ ç­‰å¾…åŒæ­¥å®Œæˆ..."),await new Promise(t=>{let i=!1;const f=setTimeout(()=>{i||(i=!0,s.matrixClient?.removeListener("sync",L),console.warn("åŒæ­¥ç­‰å¾…è¶…æ—¶ï¼Œç»§ç»­åˆ·æ–°æˆ¿é—´åˆ—è¡¨"),t(!0))},8e3),L=O=>{console.log(`ğŸ”„ åŒæ­¥çŠ¶æ€å˜åŒ–: ${O}`),(O==="PREPARED"||O==="SYNCING")&&!i&&(i=!0,clearTimeout(f),s.matrixClient?.removeListener("sync",L),console.log("âœ… åŒæ­¥çŠ¶æ€å·²æ”¹å–„"),t(!0))};s.matrixClient?.on("sync",L)})),await s.fetchMatrixRooms(),console.log(`âœ… æˆ¿é—´åˆ—è¡¨åˆ·æ–°å®Œæˆï¼Œå½“å‰æˆ¿é—´æ•°é‡: ${s.rooms.length}`),s.rooms.length===0?(console.warn("âš ï¸ ä»ç„¶æ²¡æœ‰æ‰¾åˆ°æˆ¿é—´ï¼Œå¯èƒ½éœ€è¦ï¼š"),console.warn("1. åŠ å…¥ä¸€äº›æˆ¿é—´"),console.warn("2. æ£€æŸ¥ç½‘ç»œè¿æ¥"),console.warn("3. é‡æ–°ç™»å½•"),alert(`æ²¡æœ‰æ‰¾åˆ°æˆ¿é—´ã€‚è¯·å°è¯•ï¼š
1. åŠ å…¥ä¸€äº›å…¬å…±æˆ¿é—´
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. é‡æ–°ç™»å½•`)):console.log(`âœ… æˆåŠŸåˆ·æ–°æˆ¿é—´åˆ—è¡¨ï¼Œæ‰¾åˆ° ${s.rooms.length} ä¸ªæˆ¿é—´`)}catch(o){console.error("âŒ åˆ·æ–°æˆ¿é—´åˆ—è¡¨å¤±è´¥:",o),alert("åˆ·æ–°æˆ¿é—´åˆ—è¡¨å¤±è´¥: "+(o?.message||"æœªçŸ¥é”™è¯¯"))}finally{s.loading=!1}},xe=async()=>{console.log("ğŸ› Matrixå®¢æˆ·ç«¯è°ƒè¯•ä¿¡æ¯:");try{const o=await s.generateDebugReport();console.log("ğŸ“‹ è¯¦ç»†è°ƒè¯•æŠ¥å‘Š:",o);const t={å®¢æˆ·ç«¯çŠ¶æ€:o.matrixDiagnosis.clientExists?"å·²åˆå§‹åŒ–":"æœªåˆå§‹åŒ–",è¿è¡ŒçŠ¶æ€:o.matrixDiagnosis.clientRunning?"è¿è¡Œä¸­":"å·²åœæ­¢",åŒæ­¥çŠ¶æ€:o.matrixDiagnosis.syncState||"æœªçŸ¥",ç”¨æˆ·ID:o.matrixDiagnosis.userId||"æœªè®¾ç½®",æˆ¿é—´æ•°é‡:`å®¢æˆ·ç«¯: ${o.matrixDiagnosis.roomCount}, æœ¬åœ°: ${o.storeState.roomsCount}`,ç½‘ç»œçŠ¶æ€:o.matrixDiagnosis.networkStatus,è®¤è¯çŠ¶æ€:o.matrixDiagnosis.authValid?"æœ‰æ•ˆ":"æ— æ•ˆ",å»ºè®®:o.recommendations};console.log("ğŸ“Š çŠ¶æ€æ‘˜è¦:",t);const i=`
Matrixå®¢æˆ·ç«¯è°ƒè¯•ä¿¡æ¯ï¼š
â€¢ å®¢æˆ·ç«¯çŠ¶æ€: ${t.å®¢æˆ·ç«¯çŠ¶æ€}
â€¢ è¿è¡ŒçŠ¶æ€: ${t.è¿è¡ŒçŠ¶æ€}
â€¢ åŒæ­¥çŠ¶æ€: ${t.åŒæ­¥çŠ¶æ€}
â€¢ æˆ¿é—´æ•°é‡: ${t.æˆ¿é—´æ•°é‡}
â€¢ ç½‘ç»œçŠ¶æ€: ${t.ç½‘ç»œçŠ¶æ€}
â€¢ è®¤è¯çŠ¶æ€: ${t.è®¤è¯çŠ¶æ€}

${o.recommendations.length>0?`
å»ºè®®:
`+o.recommendations.map(h=>"â€¢ "+h).join(`
`):""}

è¯¦ç»†ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚
    `.trim();alert(i);const f=s.matrixClient?.getRooms()||[];console.log("ğŸ  æ‰€æœ‰æˆ¿é—´è¯¦æƒ…:");const L=f.filter(h=>(h.name||h.getName())==="æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹"||h.roomId.includes("file-transfer")||h.getCanonicalAlias()?.includes("file-transfer"));console.log("ğŸ“ æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹æˆ¿é—´:",L.map(h=>({id:h.roomId,name:h.name||h.getName(),alias:h.getCanonicalAlias()})));const O=s.rooms.filter(h=>h.isFileTransferRoom);console.log("ğŸ’¾ æœ¬åœ°æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹æˆ¿é—´:",O),console.log("ğŸ” è¿‡æ»¤åçš„æˆ¿é—´æ•°é‡:",j.value.length),console.log("ğŸ” è¿‡æ»¤åçš„å‰5ä¸ªæˆ¿é—´:",j.value.slice(0,5).map(h=>({id:h.id,name:h.name,isFileTransferRoom:h.isFileTransferRoom}))),f.forEach((h,pe)=>{console.log(`æˆ¿é—´ ${pe+1}:`,{id:h.roomId,name:h.name||h.getName()||"æ— åç§°",alias:h.getCanonicalAlias()||"æ— åˆ«å",membership:h.getMyMembership(),memberCount:h.getJoinedMemberCount(),isSpace:h.isSpaceRoom(),type:h.getType()})}),s.currentRoomId&&(console.log("ğŸ” å½“å‰æˆ¿é—´æ¶ˆæ¯è°ƒè¯•:"),s.debugMessages(s.currentRoomId));let ge=`Matrixå®¢æˆ·ç«¯è¯Šæ–­ç»“æœ:
æ€»æˆ¿é—´æ•°: ${debugInfo.totalRooms}
å·²åŠ å…¥: ${debugInfo.joinedRooms}
æœ¬åœ°å­˜å‚¨: ${debugInfo.localRoomsCount}
åŒæ­¥çŠ¶æ€: ${debugInfo.syncState}
ç½‘ç»œè¿æ¥: ${diagnosis.networkConnectivity?"æ­£å¸¸":"å¼‚å¸¸"}
è®¤è¯çŠ¶æ€: ${diagnosis.authValid?"æœ‰æ•ˆ":"æ— æ•ˆ"}
å½“å‰æˆ¿é—´: ${s.currentRoomId||"æ— "}`;diagnosis.recommendations.length>0&&(ge+=`

ğŸ’¡ å»ºè®®:
`+diagnosis.recommendations.join(`
`)),alert(ge)}catch(o){console.error("âŒ è·å–è°ƒè¯•ä¿¡æ¯å¤±è´¥:",o),alert("è·å–è°ƒè¯•ä¿¡æ¯å¤±è´¥: "+o.message)}},be=o=>{c.value=!1},_e=async()=>{if(!s.currentRoomId){alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæˆ¿é—´");return}const o=`âš¡ å¿«é€Ÿæµ‹è¯•æ¶ˆæ¯ ${new Date().toLocaleTimeString()}`;try{console.log("ğŸš€ æµ‹è¯•å¿«é€Ÿæ¶ˆæ¯å‘é€...");const t=Date.now();await s.sendMatrixMessage(s.currentRoomId,o);const f=Date.now()-t;console.log(`âœ… å¿«é€Ÿæ¶ˆæ¯æµ‹è¯•å®Œæˆï¼Œè€—æ—¶: ${f}ms`),alert(`å¿«é€Ÿæ¶ˆæ¯å‘é€å®Œæˆï¼
è€—æ—¶: ${f}ms
å†…å®¹: ${o}`)}catch(t){console.error("âŒ å¿«é€Ÿæ¶ˆæ¯æµ‹è¯•å¤±è´¥:",t),alert(`å¿«é€Ÿæ¶ˆæ¯æµ‹è¯•å¤±è´¥: ${t}`)}},$e=()=>{b.push("/encryption-settings")},we=()=>{b.push("/device-verification")},ke=async()=>{if(!l.value){l.value=!0;try{console.log("ğŸ”„ ç”¨æˆ·æ‰‹åŠ¨é‡è¯•Matrixåˆå§‹åŒ–..."),await s.retryMatrixInitialization()?console.log("âœ… Matrixåˆå§‹åŒ–é‡è¯•æˆåŠŸ"):(console.warn("âš ï¸ Matrixåˆå§‹åŒ–é‡è¯•å¤±è´¥"),alert("Matrixåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•"))}catch(o){console.error("Matrixåˆå§‹åŒ–é‡è¯•å‡ºé”™:",o),alert("é‡è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")}finally{l.value=!1}}},Me=async()=>{try{const{cryptoConflictManager:o}=await Ee(async()=>{const{cryptoConflictManager:i}=await import("./cryptoConflictManager-Dn8jFaYI.js");return{cryptoConflictManager:i}},[]),t=o.detectConflicts();if(t.hasConflicts){const i=o.getConflictResolutionAdvice(t),f=`æ£€æµ‹åˆ°åŠ å¯†å†²çª:

å†²çªæº: ${t.conflictingSources.join(", ")}
é£é™©çº§åˆ«: ${t.riskLevel}

å»ºè®®:
${i.join(`
`)}`;alert(f)}else alert("âœ… æœªæ£€æµ‹åˆ°åŠ å¯†å†²çªï¼Œæ‚¨çš„åŠ å¯†ç¯å¢ƒæ˜¯å®‰å…¨çš„ã€‚")}catch(o){console.error("æ£€æŸ¥åŠ å¯†å†²çªå¤±è´¥:",o),alert("æ£€æŸ¥åŠ å¯†å†²çªå¤±è´¥")}},Se=async o=>{if(console.log("ğŸ—ï¸ å¼€å§‹åˆ›å»ºç¾¤èŠ:",o),!s.matrixClient){console.error("âŒ Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–"),alert("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œæ— æ³•åˆ›å»ºæˆ¿é—´");return}try{console.log("ğŸ“¡ è°ƒç”¨Matrixå®¢æˆ·ç«¯åˆ›å»ºæˆ¿é—´...");const t=await s.matrixClient.createRoom(o);console.log("âœ… æˆ¿é—´åˆ›å»ºæˆåŠŸ:",t);const i={id:t.room_id,name:o.name,alias:o.room_alias_name?`#${o.room_alias_name}:${s.matrixClient.getDomain()}`:"",topic:o.topic||"",type:o.visibility==="public"?"public":"private",isPublic:o.visibility==="public",memberCount:1,members:[s.matrixClient.getUserId()],unreadCount:0,encrypted:o.initial_state?.some(f=>f.type==="m.room.encryption")||!1,joinRule:o.preset==="public_chat"?"public":"invite",historyVisibility:"shared",lastActivity:Date.now(),avatarUrl:void 0};s.addRoom(i),console.log(`âœ… æˆ¿é—´ "${i.name}" å·²æ·»åŠ åˆ°æˆ¿é—´åˆ—è¡¨`),await new Promise(f=>setTimeout(f,1e3));try{await s.fetchMatrixRooms()}catch(f){console.warn("åˆ·æ–°æˆ¿é—´åˆ—è¡¨å¤±è´¥ï¼Œä½†ç»§ç»­é€‰æ‹©æˆ¿é—´:",f)}W(i.id),x.value=!1,console.log(`æˆ¿é—´ "${o.name}" åˆ›å»ºæˆåŠŸï¼`)}catch(t){console.error("âŒ åˆ›å»ºæˆ¿é—´å¤±è´¥:",t),alert("åˆ›å»ºæˆ¿é—´å¤±è´¥: "+(t?.message||"æœªçŸ¥é”™è¯¯"))}},Re=async()=>{I.value=!I.value,I.value&&g.value.length===0&&await ve()},ve=async()=>{if(!s.matrixClient){console.error("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–");return}A.value=!0;try{console.log("å¼€å§‹åŠ è½½å…¬å…±æˆ¿é—´...");const o=await s.matrixClient.publicRooms({limit:50,server:"matrix.org"});g.value=o.chunk||[],console.log(`åŠ è½½äº† ${g.value.length} ä¸ªå…¬å…±æˆ¿é—´`)}catch(o){console.error("åŠ è½½å…¬å…±æˆ¿é—´å¤±è´¥:",o);try{const t=await s.matrixClient.publicRooms({limit:50,server:"mozilla.org"});g.value=t.chunk||[],console.log(`ä»mozilla.orgåŠ è½½äº† ${g.value.length} ä¸ªå…¬å…±æˆ¿é—´`)}catch(t){console.error("ä»å¤‡ç”¨æœåŠ¡å™¨åŠ è½½å…¬å…±æˆ¿é—´ä¹Ÿå¤±è´¥:",t)}}finally{A.value=!1}},Ie=async o=>{if(!s.matrixClient){console.error("Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–");return}try{console.log("å°è¯•åŠ å…¥æˆ¿é—´:",o);const t=g.value.find(i=>i.room_id===o);if(await s.matrixClient.joinRoom(o),console.log("æˆåŠŸåŠ å…¥æˆ¿é—´:",o),t){const i={id:t.room_id,name:t.name||t.canonical_alias||t.room_id,alias:t.canonical_alias,topic:t.topic,type:"public",isPublic:t.world_readable||!0,memberCount:t.num_joined_members||0,members:[],unreadCount:0,encrypted:!1,joinRule:"public",historyVisibility:"shared",avatarUrl:t.avatar_url?s.matrixClient.mxcUrlToHttp(t.avatar_url):void 0,lastActivity:Date.now()};s.addRoom(i),console.log(`âœ… æˆ¿é—´ "${i.name}" å·²æ·»åŠ åˆ°æˆ¿é—´åˆ—è¡¨`),W(i.id)}I.value=!1}catch(t){console.error("åŠ å…¥æˆ¿é—´å¤±è´¥:",t),alert("åŠ å…¥æˆ¿é—´å¤±è´¥: "+(t?.message||"æœªçŸ¥é”™è¯¯"))}};De(async()=>{if(console.log("ğŸš€ WeChatStyleLayout ç»„ä»¶æŒ‚è½½å¼€å§‹"),Le(),s.matrixClient&&s.isConnected&&s.rooms.length>0){console.log("âœ… Matrixå®¢æˆ·ç«¯å·²å­˜åœ¨ä¸”å·²è¿æ¥ï¼Œä¸”æœ‰æˆ¿é—´æ•°æ®ï¼Œè·³è¿‡åˆå§‹åŒ–");return}try{console.log("ğŸ”„ å¼€å§‹åˆå§‹åŒ–MatrixçŠ¶æ€...");const i=await s.initializeMatrix();if(console.log("ğŸ“Š Matrixåˆå§‹åŒ–ç»“æœ:",i),i&&s.rooms.length>0){console.log("âœ… Matrixå·²åˆå§‹åŒ–ä¸”æœ‰æˆ¿é—´æ•°æ®ï¼Œæˆ¿é—´æ•°é‡:",s.rooms.length);return}else if(i&&s.rooms.length===0){console.log("âš ï¸ Matrixå·²åˆå§‹åŒ–ä½†æ²¡æœ‰æˆ¿é—´æ•°æ®ï¼Œå°è¯•è·å–æˆ¿é—´...");try{if(await s.fetchMatrixRooms(),s.rooms.length>0){console.log("âœ… æˆåŠŸè·å–æˆ¿é—´æ•°æ®ï¼Œæˆ¿é—´æ•°é‡:",s.rooms.length);return}}catch(f){console.warn("è·å–æˆ¿é—´å¤±è´¥:",f)}}}catch(i){console.error("âŒ Matrixåˆå§‹åŒ–å¤±è´¥:",i)}const o=localStorage.getItem("matrix_access_token"),t=localStorage.getItem("matrix_login_info");if(console.log("ğŸ“Š æ£€æŸ¥å­˜å‚¨çš„ç™»å½•ä¿¡æ¯:",{hasToken:!!o,hasLoginInfo:!!t,isLoggedIn:s.isLoggedIn,hasClient:!!s.matrixClient,roomsCount:s.rooms.length}),o&&t){if(console.log("âœ… å‘ç°å­˜å‚¨çš„ç™»å½•ä¿¡æ¯ï¼Œä½†å¯èƒ½éœ€è¦é‡æ–°åŒæ­¥"),s.rooms.length===0){console.log("ğŸ”„ æœ‰ç™»å½•ä¿¡æ¯ä½†æ— æˆ¿é—´ï¼Œå°è¯•é‡æ–°è·å–...");try{await me()}catch(i){console.warn("é‡æ–°è·å–æˆ¿é—´å¤±è´¥:",i)}}}else s.rooms.length===0?(console.log("âŒ æ²¡æœ‰æ‰¾åˆ°å­˜å‚¨çš„ç™»å½•ä¿¡æ¯ä¸”æ— æˆ¿é—´åˆ—è¡¨ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢"),b.push("/login")):console.log("ğŸ“š è™½ç„¶æ²¡æœ‰ç™»å½•ä¿¡æ¯ï¼Œä½†æœ‰æˆ¿é—´åˆ—è¡¨ï¼Œå…è®¸ç•Œé¢æ˜¾ç¤º")});const G=[],Le=()=>{console.log("ğŸ¯ è®¾ç½®æ»šåŠ¨æ€§èƒ½ä¼˜åŒ–..."),J(()=>{try{const o=document.querySelector(".chat-list");if(o){const f=re.createOptimizedScrollListener(o,L=>{L.velocityY&&Math.abs(L.velocityY)>2&&v({message:"Fast scrolling detected in chat list",metric:"scroll_jank",value:Math.abs(L.velocityY),threshold:2,componentName:"WeChatStyleLayout",context:{scrollInfo:L}})},{throttleDelay:16,includeVelocity:!0});G.push(f)}const t=document.querySelector(".message-list");if(t){const f=re.createOptimizedScrollListener(t,L=>{},{throttleDelay:16});G.push(f)}const i=document.querySelector(".public-rooms-list");if(i){const f=re.createOptimizedScrollListener(i,L=>{},{throttleDelay:16});G.push(f)}console.log("âœ… æ»šåŠ¨æ€§èƒ½ä¼˜åŒ–è®¾ç½®å®Œæˆ")}catch(o){console.error("âŒ æ»šåŠ¨ä¼˜åŒ–è®¾ç½®å¤±è´¥:",o),_(o,{context:"scroll_optimization_setup"})}})};return Ve(()=>{console.log("ğŸ§¹ æ¸…ç†WeChatStyleLayoutç»„ä»¶..."),G.forEach(o=>{try{o()}catch(t){console.error("æ¸…ç†æ»šåŠ¨ç›‘å¬å™¨å¤±è´¥:",t)}}),G.length=0,console.log("âœ… WeChatStyleLayoutç»„ä»¶æ¸…ç†å®Œæˆ")}),(o,t)=>(d(),u("div",mo,[e("div",vo,[e("div",go,[e("div",po,[e("div",fo,m(Z(D(s).currentUser?.displayName||D(s).currentUser?.username||"U")),1)])]),e("div",ho,[e("div",{class:U(["nav-item",{active:$.value==="chat"}]),title:"èŠå¤©",onClick:t[0]||(t[0]=i=>F("chat"))},t[12]||(t[12]=[e("span",{class:"nav-icon"},"ğŸ’¬",-1)]),2),e("div",{class:U(["nav-item",{active:$.value==="contacts"}]),title:"é€šè®¯å½•",onClick:t[1]||(t[1]=i=>F("contacts"))},t[13]||(t[13]=[e("span",{class:"nav-icon"},"ğŸ‘¥",-1)]),2),e("div",{class:U(["nav-item",{active:$.value==="favorites"}]),title:"æ”¶è—",onClick:t[2]||(t[2]=i=>F("favorites"))},t[14]||(t[14]=[e("span",{class:"nav-icon"},"â­",-1)]),2),e("div",{class:U(["nav-item",{active:$.value==="files"}]),title:"æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹",onClick:t[3]||(t[3]=i=>F("files"))},t[15]||(t[15]=[e("span",{class:"nav-icon"},"ğŸ“",-1)]),2)]),t[16]||(t[16]=e("div",{class:"sidebar-footer"},[e("div",{class:"nav-item",title:"è®¾ç½®"},[e("span",{class:"nav-icon"},"âš™ï¸")])],-1))]),e("div",yo,[e("div",Co,[D(s).currentUser?(d(),u("div",xo,[e("div",bo,m(Z(D(s).currentUser.displayName||D(s).currentUser.username)),1),e("span",_o,m(D(s).currentUser.displayName||D(s).currentUser.username),1)])):w("",!0),e("div",$o,[e("button",{class:"action-btn primary",onClick:n,title:"å‘èµ·èŠå¤©"},t[17]||(t[17]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1)])),e("button",{class:"action-btn primary",onClick:a,title:"åˆ›å»ºç¾¤èŠ"},t[18]||(t[18]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-1c0-2.66 5.33-4 8-4s8 1.34 8 4v1H4zM12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"})],-1)])),e("button",{class:"action-btn primary",onClick:r,title:"åŠ å…¥æˆ¿é—´"},t[19]||(t[19]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)])),e("div",{class:"more-actions",ref_key:"moreActionsRef",ref:ne},[e("button",{class:U(["action-btn more-btn",{active:B.value}]),onClick:ie,title:"æ›´å¤šæ“ä½œ"},t[20]||(t[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)]),2),B.value?(d(),u("div",wo,[e("button",{class:"menu-item",onClick:Re},t[21]||(t[21]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})],-1),z(" æ¢ç´¢æˆ¿é—´ ")])),e("button",{class:"menu-item",onClick:me},t[22]||(t[22]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1),z(" åˆ·æ–°æˆ¿é—´ ")])),t[30]||(t[30]=e("div",{class:"menu-divider"},null,-1)),e("button",{class:"menu-item",onClick:xe},t[23]||(t[23]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.42.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8z"})],-1),z(" è°ƒè¯•å·¥å…· ")])),e("button",{class:"menu-item",onClick:Ce},t[24]||(t[24]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),z(" å¼ºåˆ¶åˆ›å»ºæ–‡ä»¶åŠ©æ‰‹ ")])),e("button",{class:"menu-item",onClick:t[4]||(t[4]=(...i)=>o.forceSync&&o.forceSync(...i))},t[25]||(t[25]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z"})],-1),z(" å¼ºåˆ¶åŒæ­¥ ")])),e("button",{class:"menu-item",onClick:_e},t[26]||(t[26]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M7 14l5-5 5 5z"})],-1),z(" æµ‹è¯•æ¶ˆæ¯ ")])),e("button",{class:"menu-item",onClick:$e},t[27]||(t[27]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})],-1),z(" åŠ å¯†è®¾ç½® ")])),e("button",{class:"menu-item",onClick:we},t[28]||(t[28]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"})],-1),z(" è®¾å¤‡éªŒè¯ ")])),e("button",{class:"menu-item",onClick:Me},t[29]||(t[29]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"})],-1),z(" æ£€æŸ¥å†²çª ")]))])):w("",!0)],512)])]),e("div",ko,[e("div",Mo,[t[31]||(t[31]=e("span",{class:"search-icon"},"ğŸ”",-1)),V(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=i=>M.value=i),placeholder:"æœç´¢",class:"search-input"},null,512),[[H,M.value]])])]),e("div",So,[D(s).loading&&D(s).rooms.length===0?(d(),u("div",Ro,t[32]||(t[32]=[e("div",{class:"loading-spinner"},null,-1),e("div",{class:"loading-message"},"æ­£åœ¨åŠ è½½èŠå¤©åˆ—è¡¨...",-1)]))):w("",!0),!D(s).matrixClient&&!D(s).loading?(d(),u("div",Io,[t[33]||(t[33]=e("div",{class:"warning-icon"},"âš ï¸",-1)),t[34]||(t[34]=e("div",{class:"warning-message"},"Matrixå®¢æˆ·ç«¯æœªåˆå§‹åŒ–",-1)),t[35]||(t[35]=e("div",{class:"warning-description"},"è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–å°è¯•é‡æ–°åˆå§‹åŒ–",-1)),e("button",{onClick:ke,class:"retry-button",disabled:l.value},m(l.value?"é‡è¯•ä¸­...":"ğŸ”„ é‡è¯•åˆå§‹åŒ–"),9,Lo)])):j.value.length===0?(d(),u("div",To,t[36]||(t[36]=[e("div",{class:"empty-message"},"æš‚æ— èŠå¤©",-1)]))):w("",!0),(d(!0),u(K,null,q(j.value,i=>(d(),u("div",{key:i.id,class:U(["chat-item",{active:R.value===i.id}]),onClick:f=>W(i.id)},[e("div",zo,m(Q(i.name)),1),e("div",Vo,[e("div",Eo,[e("span",Ho,m(i.name),1),i.lastEventTimestamp?(d(),u("span",Uo,m(ae(i.lastEventTimestamp)),1)):w("",!0)]),e("div",No,[e("span",Ao,m(i.lastMessage||"æš‚æ— æ¶ˆæ¯"),1),e("div",Bo,[i.unreadCount>0?(d(),u("span",jo,m(i.unreadCount),1)):w("",!0)])])])],10,Do))),128))]),e("div",{class:"chat-list-footer"},[e("button",{class:"logout-btn",onClick:le,title:"é€€å‡ºç™»å½•"},t[37]||(t[37]=[e("span",{class:"logout-icon"},"ğŸšª",-1),e("span",{class:"logout-text"},"é€€å‡º",-1)]))])]),e("div",Fo,[R.value?(d(),u("div",Wo,[e("div",Go,[de(wt,{"room-id":R.value},null,8,["room-id"])])])):(d(),u("div",Po,t[38]||(t[38]=[e("div",{class:"welcome-chat"},[e("div",{class:"icon-message-large"},"ğŸ’¬"),e("h2",null,"é€‰æ‹©ä¸€ä¸ªå¯¹è¯"),e("p",null,"ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªèŠå¤©å¼€å§‹å¯¹è¯")],-1)])))]),I.value?(d(),u("div",Oo,[e("div",Jo,[t[39]||(t[39]=e("h3",null,"æ¢ç´¢å…¬å…±æˆ¿é—´",-1)),e("button",{class:"close-btn",onClick:t[6]||(t[6]=i=>I.value=!1)},"Ã—")]),e("div",Ko,[e("div",qo,[V(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=i=>C.value=i),placeholder:"æœç´¢å…¬å…±æˆ¿é—´...",class:"search-input"},null,512),[[H,C.value]])]),e("div",Yo,[A.value?(d(),u("div",Zo,t[40]||(t[40]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"æ­£åœ¨åŠ è½½å…¬å…±æˆ¿é—´...",-1)]))):P.value.length>0?(d(),u("div",Qo,[(d(!0),u(K,null,q(P.value,i=>(d(),u("div",{key:i.room_id,class:"public-room-item"},[e("div",Xo,m(Q(i.name||i.canonical_alias||i.room_id)),1),e("div",es,[e("div",ts,m(i.name||i.canonical_alias||i.room_id),1),e("div",os,m(i.topic||"æ— æè¿°"),1),e("div",ss,m(i.num_joined_members||0)+" æˆå‘˜",1)]),e("div",ns,[e("button",{class:"join-btn",onClick:f=>Ie(i.room_id)}," åŠ å…¥ ",8,is)])]))),128))])):(d(),u("div",ls,[t[41]||(t[41]=e("div",{class:"empty-icon"},"ğŸ ",-1)),t[42]||(t[42]=e("p",null,"æ²¡æœ‰æ‰¾åˆ°å…¬å…±æˆ¿é—´",-1)),e("button",{class:"retry-btn",onClick:ve},"é‡æ–°åŠ è½½")]))])])])):w("",!0),c.value?(d(),ce(Ft,{key:1,onClose:t[8]||(t[8]=i=>c.value=!1),onStartDm:be})):w("",!0),x.value?(d(),ce(uo,{key:2,onClose:t[9]||(t[9]=i=>x.value=!1),onCreateGroup:Se})):w("",!0),E.value?(d(),u("div",{key:3,class:"modal-overlay",onClick:S},[e("div",{class:"modal-content",onClick:t[11]||(t[11]=ue(()=>{},["stop"]))},[e("div",{class:"modal-header"},[t[43]||(t[43]=e("h3",null,"ğŸ  åŠ å…¥æˆ¿é—´",-1)),e("button",{class:"close-btn",onClick:S},"âœ•")]),e("div",as,[e("div",rs,[t[44]||(t[44]=e("label",null,"æˆ¿é—´åœ°å€",-1)),V(e("input",{"onUpdate:modelValue":t[10]||(t[10]=i=>T.value=i),type:"text",placeholder:"è¾“å…¥æˆ¿é—´åˆ«åæˆ–IDï¼Œå¦‚ï¼š#friesport:mozilla.org",class:"room-input",onKeyup:ee(X,["enter"])},null,544),[[H,T.value]]),t[45]||(t[45]=e("div",{class:"input-hint"}," æ”¯æŒæˆ¿é—´åˆ«åï¼ˆ#roomname:server.orgï¼‰æˆ–æˆ¿é—´IDï¼ˆ!roomid:server.orgï¼‰ ",-1))])]),e("div",cs,[e("button",{class:"cancel-btn",onClick:S},"å–æ¶ˆ"),e("button",{class:"join-btn primary",onClick:X,disabled:!T.value.trim()||p.value},m(p.value?"åŠ å…¥ä¸­...":"åŠ å…¥æˆ¿é—´"),9,ds)])])])):w("",!0)]))}}),ps=se(us,[["__scopeId","data-v-15a06312"]]);export{ps as default};
